(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{16:function(t,e,n){"use strict";var i=n(1),o=n(4);class s{constructor(t,e){this.id=Object(o.b)(),this.x=void 0,this.y=void 0,this.x=t,this.y=e}clone(){return new s(this.x,this.y)}distanceTo(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}setXY(t,e){this.x=t,this.y=e}set(t){this.x=t.x,this.y=t.y}findNearest(t){let e=null,n=1/0;return t.forEach(t=>{const i=this.distanceTo(t);i<n&&(e=t,n=i)}),e}add(t){return new s(this.x+t.x,this.y+t.y)}subtract(t){return new s(this.x-t.x,this.y-t.y)}scale(t){return new s(this.x*t,this.y*t)}}Object(o.f)(s,"Vector2",["x","y"]),Object(i.i)(s,{x:i.n,y:i.n}),e.a=s},228:function(t,e,n){n(227),t.exports=n(88)},4:function(t,e,n){"use strict";var i=n(3),o=n.n(i);let s=0;const r=()=>`${Date.now().toString(36)}.${(s++).toString(36)}`;function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){l(t,e,n[e])})}return t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"c",function(){return P}),n.d(e,"d",function(){return y}),n.d(e,"e",function(){return f}),n.d(e,"f",function(){return C}),n.d(e,"g",function(){return S}),n.d(e,"a",function(){return k}),n.d(e,"b",function(){return r});const h=t=>new Error(`impossible value ${t}`),c=new Map,d=new Map,p=(t,e)=>({ctor:e.ctor||t.ctor,name:e.name||t.name,primitives:[...t.primitives,...e.primitives],refs:a({},t.refs,e.refs)}),u=t=>{const e=c.get(t);return o()(e,`model ${t.__proto__.constructor.name} is not serializable`),e},m=(t,e)=>{const n=(t=t,o()(!String(t.id).includes("#"),`id "${String(t.id)}" must not include "#"`),`${u(t.__proto__.constructor).name}#${String(t.id)}`);return e[n]||(e[n]=g(t,e)),n};var v;const w=(t,e,n)=>{if(null===e)return null;switch(t.type){case"one":return m(e,n);case"list":return((t,e)=>t.map(t=>m(t,e)))(e,n);case"object-map":return((t,e)=>Object.keys(t).map(n=>[n,m(t[n],e)]).reduce((t,[e,n])=>a({},t,{[e]:n}),{}))(e,n);default:throw h(t.type)}},g=(t,e)=>{const n=u(t.__proto__.constructor),i=n.primitives,o=n.refs,s={};return i.forEach(e=>s[e]=t[e]),Object.keys(o).forEach(n=>{s[n]=w(o[n],t[n],e)}),s},P=t=>({type:"one",target:t}),y=t=>({type:"list",target:t}),f=t=>({type:"object-map",target:t}),b=t=>{const e=t.__proto__,n=e?b(e):[],i=c.get(t);return i?[...n,i]:n},C=(t,e,n,i={})=>{o()(!e.includes("#"),`name "${e}" cant include "#"`),o()(!d.has(e),`serializable class with name ${e} already exists`);const s=[...b(t),{ctor:t,name:e,primitives:n,refs:i}].reduce(p);c.set(t,s),d.set(e,s)},S=t=>{const e={};return{rootId:m(t,e),objectsById:e}},E=(t,e,n={})=>{if(!n[e]){const i=t[e];o()(i,`no object found for id ${String(e)}`);const s=(t=>{const e=t.split("#");o()(2===e.length,`invalid id "${t}"`);const n=d.get(e[0]);return o()(n,`unknown serialize model ${e[0]}`),{model:n,id:e[1]}})(e),r=s.model,l=s.id,c=r.primitives,p=r.refs,u=new(0,r.ctor);u.id=l,c.forEach(t=>u[t]=i[t]),Object.keys(p).forEach(e=>{u[e]=((t,e,n,i={})=>{if(null===e)return null;switch(t.type){case"one":return E(n,e,i);case"list":return e.map(t=>E(n,t,i));case"object-map":return Object.keys(e).map(t=>[t,E(n,e[t],i)]).reduce((t,[e,n])=>a({},t,{[e]:n}),{});default:throw h(t.type)}})(p[e],i[e],t,n)}),n[e]=u}return n[e]},k=t=>{const e=t.rootId,n=t.objectsById;return E(n,e)}},57:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return r});var i=n(3),o=n.n(i);n(16);n(92);var s=function(){var e,n,i,s=function(t,e){var n=function(t,e){var n=0;if(!t.length)return Math.sqrt(Math.pow(t-e,2));for(var i=0;i<t.length;i++)n+=Math.pow(t[i]-e[i],2);return Math.sqrt(n)}(t,e);return 0===n?0:Math.pow(n,2)*Math.log(n)};this.compile=function(r,a){o()(r&&r.length,"bad centers array :/"),e=r.map(function(t){return t}),i=a.map(function(t){return t});for(var l=[],h=[],c=[],d=[],p=0;p<e.length;p++){h=[],d=[1];for(var u=0;u<e[p].length;u++)d.push(e[p][u]);for(var m=0;m<e.length;m++)h.push(s(e[p],e[m]));c.push(d),l.push(h.concat(d))}var v=t.$M(c).transpose().elements.map(function(t){for(var e=t.length;e<l[0].length;e++)t.push(0);return t});for(p=0;p<v.length;p++)l.push(v[p]),i.push(0);n=this._solve(i,l),o()(n,"rbf failed to compile with given centers./nCenters must be unique :/")},this._solve=function(e,n){var i=t.$M(n),o=t.$V(e);if(i=i.inverse())return i.multiply(o)},this.getValue=function(t){var i=0,o=0;for(o=0;o<e.length;o++)i+=Number(n.elements[o])*s(t,e[o]);for(i+=Number(n.elements[e.length]),o=0;o<t.length;o++)i+=t[o]*Number(n.elements[e.length+(o+1)]);return i},this.getValues=function(t,e){setTimeout(function(){var n=t.map(function(t){return this.getValue(t)},this);e(null,{points:t,ys:n})}.bind(this),0)}};class r{constructor(t,e){this.tps=new s,this.tps.compile(t.map(({x:t,y:e})=>[t,e]),e)}getValue(t){return this.tps.getValue([t.x,t.y])}}}).call(this,n(20))},88:function(t,e,n){"use strict";n.r(e);var i=n(0),o=n.n(i),s=n(19),r=n.n(s),a=n(3),l=n.n(a),h=n(229),c=n.n(h),d=n(7),p=n(84),u=n.n(p);const m=()=>document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,v={position:"fixed",top:"0px",left:"0px",width:"100%",height:"100%",zIndex:"10000",touchAction:"none"};class w{constructor({down:t,move:e,up:n}={}){this.onDown=null,this.onMove=null,this.onUp=null,this.attachedTo=null,this.cover=void 0,this.onDown=t,this.onMove=e,this.onUp=n;const i=document.createElement("div");Object.assign(i.style,v),i.setAttribute("touch-action","none"),this.cover=i}attach(){if(!this.attachedTo){const t=m()||document.body;l()(null!=t,"target must exist"),t.appendChild(this.cover),this.attachedTo=t,this.attachEvents()}}remove(){const t=this.attachedTo;t&&(this.attachedTo=null,this.removeEvents(),t.removeChild(this.cover))}attachEvents(){this.onDown&&this.cover.addEventListener("pointerdown",this.onDown,!1),this.onMove&&this.cover.addEventListener("pointermove",this.onMove,!1),this.onUp&&this.cover.addEventListener("pointerup",this.onUp,!1)}removeEvents(){this.onDown&&this.cover.removeEventListener("pointerdown",this.onDown),this.onMove&&this.cover.removeEventListener("pointermove",this.onMove),this.onUp&&this.cover.removeEventListener("pointerup",this.onUp)}}var g=n(25),P=n.n(g),y=n(1),f=n(16);var b=Object(y.i)(class extends P.a{constructor(t){super(),this.viewport=void 0,this.screenPosition=null,this.isDown=!1,this.viewport=t}get isActive(){return null!==this.screenPosition}get scenePosition(){const t=this.screenPosition;return t?this.viewport.screenCoordsToSceneCoords(t.x,t.y):null}setPosition(t,e){this.screenPosition?this.screenPosition.setXY(t,e):this.screenPosition=new f.a(t,e)}clearPosition(){this.screenPosition=null}triggerPointerDown(){this.isDown=!0,this.emit("pointerDown")}triggerPointerMove(){this.emit("pointerMove")}triggerPointerUp(){this.isDown=!1,this.emit("pointerUp")}onPointerDown(t){const e=()=>t(this.viewport);return this.addListener("pointerDown",e),()=>{this.removeListener("pointerDown",e)}}onPointerMove(t){const e=()=>t(this.viewport);return this.addListener("pointerMove",e),()=>{this.removeListener("pointerMove",e)}}onPointerUp(t){const e=()=>t(this.viewport);return this.addListener("pointerUp",e),()=>{this.removeListener("pointerUp",e)}}get hoveredItem(){return this.scenePosition?this.viewport.getItemAtSceneCoord(this.scenePosition):null}},{isDown:y.n,screenPosition:y.n,scenePosition:y.f,isActive:y.f,hoveredItem:y.f,setPosition:y.d,triggerPointerDown:y.d,triggerPointerMove:y.d,triggerPointerUp:y.d}),C=n(34),S=n.n(C);class E{constructor(){this._events=new P.a,this._isPressedByKeyCode={},this.handleKeyDown=(t=>{this._isPressedByKeyCode[t.keyCode]=!0,this._events.emit(`keyDown:${t.keyCode}`)}),this.handleKeyUp=(t=>{this._isPressedByKeyCode[t.keyCode]=!1,this._events.emit(`keyUp:${t.keyCode}`)})}setup(){window.addEventListener("keydown",this.handleKeyDown,!1),window.addEventListener("keyup",this.handleKeyUp,!1)}teardown(){window.removeEventListener("keydown",this.handleKeyDown,!1),window.removeEventListener("keyup",this.handleKeyUp,!1)}keyCodeOrNameToKeyCode(t){return"number"===typeof t?t:S()(t)}isPressed(t){const e=this.keyCodeOrNameToKeyCode(t);return!!this._isPressedByKeyCode[e]}onKeyDown(t,e){const n=this.keyCodeOrNameToKeyCode(t),i=()=>e();return this._events.addListener(`keyDown:${n}`,i),()=>{this._events.removeListener(`keyDown:${n}`,i)}}onKeyUp(t,e){const n=this.keyCodeOrNameToKeyCode(t),i=()=>e();return this._events.addListener(`keyUp:${n}`,i),()=>{this._events.removeListener(`keyUp:${n}`,i)}}}Object(y.i)(E,{_isPressedByKeyCode:y.n,handleKeyDown:y.d,handleKeyUp:y.d});var k=new E;const x=15,O=document.createElement("canvas").getContext("2d");var D=Object(y.i)(class extends P.a{constructor(t){super(),this.keyboard=k,this.top=0,this.left=0,this.bottom=0,this.right=0,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.scale=window.devicePixelRatio||1,this.editor=void 0,this.basePoint=new f.a(0,0),this.pointer=new b(this),this.sceneCoordsToScreenCoords=((t,e)=>new f.a(t*this.zoom+this.panX+this.left,e*this.zoom+this.panY+this.top)),this.screenCoordsToSceneCoords=((t,e)=>new f.a((t-this.left-this.panX)/this.zoom,(e-this.top-this.panY)/this.zoom)),this.editor=t,this.basePoint.set(t.scene.keyPointSet.keyPoints[0])}get sceneWidth(){return this.editor.scene.width}get sceneHeight(){return this.editor.scene.height}get pxWidth(){return this.windowWidth-this.left-this.right}get pxHeight(){return this.windowHeight-this.top-this.bottom}get zoom(){const t=this.pxWidth-2*x,e=this.pxHeight-2*x;return Math.min(t/this.sceneWidth,e/this.sceneHeight)}get panX(){const t=this.pxWidth-2*x;return this.zoom*this.sceneWidth<t?x+(t/2-this.zoom*this.sceneWidth/2):x}get panY(){const t=this.pxHeight-2*x;return this.zoom*this.sceneHeight<t?x+(t/2-this.zoom*this.sceneHeight/2):x}get px(){return 1/this.zoom}get nearestKeyPoint(){const t=this.basePoint.findNearest(this.editor.scene.keyPointSet.keyPoints);return l()(t,"nearest must be found"),t}get scene(){return this.editor.scene}setSize(t,e,n,i,o,s,r){this.windowWidth=t,this.windowHeight=e,this.scale=n,this.left=i,this.top=o,this.right=s,this.bottom=r}getItemAtSceneCoord(t){const e=8*this.px;O.lineWidth=e;for(const n of this.editor.scene.shapes){for(const o of n.points)if(t.distanceTo(o.originPoint.getAtBasePoint(this.basePoint))<e)return{type:"MagicPointThingySelectionItem",point:o,inShape:n};const i=n.getCanvasPathAtBasePoint(this.basePoint);if(O.isPointInStroke(i,t.x,t.y))return{type:"ShapeSelectionItem",shape:n}}return null}},{windowWidth:y.n,windowHeight:y.n,scale:y.n,top:y.n,left:y.n,bottom:y.n,right:y.n,editor:y.n,pointer:y.n,sceneWidth:y.f,sceneHeight:y.f,pxWidth:y.f,pxHeight:y.f,zoom:y.f,panX:y.f,panY:y.f,px:y.f,scene:y.f,nearestKeyPoint:l.a,setSize:y.d});const M=i.createContext(null),j=M.Provider,T=M.Consumer,K=({children:t})=>i.createElement(T,null,e=>(l()(e,"Viewport must exist"),t(e)));class A extends i.Component{constructor(...t){var e;return e=super(...t),this.state={viewport:null},this.sizer=null,this.pointableCover=void 0,this.isPointerDown=!1,this.handleResize=(()=>{this.setViewportSize(this.state.viewport)}),this.sizerRef=(t=>{this.sizer=t}),this.handleMouseDown=(()=>{const t=this.state.viewport;l()(t,"viewport must exist"),this.isPointerDown=!0,this.pointableCover.attach(),t.pointer.triggerPointerDown()}),this.handleMouseMove=(t=>{const e=this.state.viewport;l()(e,"viewport must exist"),e.pointer.setPosition(t.clientX,t.clientY),e.pointer.triggerPointerMove()}),this.handleMouseUp=(()=>{const t=this.state.viewport;l()(t,"viewport must exist"),this.isPointerDown=!1,this.pointableCover.remove(),t.pointer.triggerPointerUp();const e=t.pointer.screenPosition;l()(e,"viewport pointer must be active"),(t.left>e.x||e.x>t.windowWidth-t.right||t.top>e.y||e.y>t.windowHeight-t.bottom)&&t.pointer.clearPosition()}),this.handleMouseLeave=(()=>{const t=this.state.viewport;l()(t,"viewport must exist"),this.isPointerDown||t.pointer.clearPosition()}),e}componentDidMount(){this.pointableCover=new w({down:this.handleMouseDown,move:this.handleMouseMove,up:this.handleMouseUp});const t=new D(this.props.editor);this.setState({viewport:t}),this.setViewportSize(t),window.addEventListener("resize",this.handleResize)}componentDidUpdate(){this.setViewportSize(this.state.viewport)}componentWillUnmount(){this.pointableCover.remove(),window.removeEventListener("resize",this.handleResize)}setViewportSize(t){const e=this.sizer;l()(e,"container must be set"),l()(t,"viewport must be set");const n=window.innerWidth,i=window.innerHeight,o=window.devicePixelRatio||1,s=e.getBoundingClientRect(),r=s.left,a=s.top,h=s.right,c=s.bottom;t.setSize(n,i,o,r,a,n-h,i-c)}renderViewport(t){const e=this.props,n=e.children,o=e.editor;return l()(t.editor===o,"prop editor must not change"),i.createElement(j,{value:t},n)}render(){const t=this.props,e=t.style,n=t.children,o=t.editor,s=this.state.viewport;return s&&l()(s.editor===o,"prop editor must not change"),i.createElement(i.Fragment,null,s&&i.createElement(j,{value:s},n),i.createElement("div",{ref:this.sizerRef,style:e,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseLeave}))}}const _=t=>{var e,n;return n=e=class extends i.Component{render(){return i.createElement(K,null,e=>i.createElement(t,Object.assign({},this.props,{viewport:e})))}},e.displayName=`withViewport(${u()(t)})`,n};var I=n(26),U=n(242),R=n.n(U),B=n(241),z=n.n(B),W=n(82),L=n.n(W);var $=Object(I.withStyles)(t=>({appBar:{zIndex:t.zIndex.drawer+1}}))(({classes:t})=>o.a.createElement(R.a,{position:"absolute",className:t.appBar},o.a.createElement(z.a,null,o.a.createElement(L.a,{variant:"title",color:"inherit"},"Drag Animate")))),N=n(87),H=n.n(N),V=n(86),X=n.n(V),Y=n(240),F=n.n(Y),G=n(85),q=n.n(G),J=n(239),Q=n.n(J);var Z=t=>t;var tt=Z(Object(I.withStyles)(t=>({drawerPaper:{width:300},addButton:{position:"absolute",bottom:2*t.spacing.unit,right:2*t.spacing.unit},toolbar:t.mixins.toolbar}))(Object(d.a)(class extends o.a.Component{render(){const t=this.props,e=t.classes,n=t.editor;return o.a.createElement(H.a,{variant:"permanent",anchor:"right",classes:{paper:e.drawerPaper}},o.a.createElement("div",{className:e.toolbar}),o.a.createElement(X.a,{subheader:o.a.createElement(F.a,null,"Shapes")},n.scene.shapes.map((t,e)=>o.a.createElement(q.a,{key:e,button:!0},o.a.createElement(Q.a,null,o.a.createElement("pre",null,JSON.stringify(t,null,2)))))))}}))),et=n(236),nt=n.n(et),it=n(235),ot=n.n(it);var st={SELECT:"SELECT",PEN:"PEN"},rt=n(12),at=n.n(rt),lt=n(237),ht=n.n(lt),ct=n(238),dt=n.n(ct);var pt=class extends o.a.Component{constructor(...t){var e;return e=super(...t),this._unsubscribes=[],this.handleKeyDown=(()=>{this.props.onDown&&this.props.onDown(k)}),this.handleKeyUp=(()=>{this.props.onUp&&this.props.onUp(k)}),e}componentDidMount(){this.listen()}componentDidUpdate(t){t.name!==this.props.name&&(this.unsubscribe(),this.listen())}listen(){const t=this.props.name;this._unsubscribes.push(k.onKeyDown(t,this.handleKeyDown)),this._unsubscribes.push(k.onKeyUp(t,this.handleKeyUp))}unsubscribe(){this._unsubscribes.forEach(t=>t()),this._unsubscribes=[]}render(){return null}};var ut=Object(I.withStyles)(t=>({listItem:{padding:1.5*t.spacing.unit},active:{color:t.palette.primary.light},inactive:{color:t.palette.text.primary},popper:{}}))(Object(d.a)(class extends i.Component{constructor(...t){var e;return e=super(...t),this.handleClick=(()=>{const t=this.props,e=t.editor,n=t.tool;e.setTool(n)}),e}render(){const t=this.props,e=t.name,n=t.shortcutKey,o=t.tool,s=t.editor,r=t.icon,a=t.classes;return i.createElement(i.Fragment,null,i.createElement(pt,{name:n,onDown:this.handleClick}),i.createElement(dt.a,{title:`${e} (${n.toUpperCase()})`,placement:"right",classes:{popper:a.popper}},i.createElement(q.a,{button:!0,classes:{root:at()(a.listItem,{[a.active]:o===s.tool})},onClick:this.handleClick},i.createElement(ht.a,{classes:{root:o===s.tool?a.active:a.inactive}},r))))}}));var mt=Z(Object(I.withStyles)(t=>({drawerPaper:{width:48},toolbar:t.mixins.toolbar}))(Object(d.a)(class extends o.a.Component{render(){const t=this.props,e=t.classes,n=t.editor;return o.a.createElement(H.a,{variant:"permanent",anchor:"left",classes:{paper:e.drawerPaper}},o.a.createElement("div",{className:e.toolbar}),o.a.createElement(X.a,null,o.a.createElement(ut,{name:"Select",shortcutKey:"v",tool:st.SELECT,icon:o.a.createElement(nt.a,null),editor:n}),o.a.createElement(ut,{name:"Pen",shortcutKey:"p",tool:st.PEN,icon:o.a.createElement(ot.a,null),editor:n})))}}))),vt=n(234),wt=n.n(vt);function gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Pt=Object(d.a)(class extends i.Component{constructor(...t){var e;return e=super(...t),this.canvas=null,this.ctx=null,this.disposeRenderer=null,this.draw=(()=>{const t=this.ctx;if(!t)return;const e=window.devicePixelRatio,n=this.props,i=n.width,o=n.height,s=n.draw;t.save(),t.scale(e,e),t.clearRect(0,0,i,o),s(t),t.restore()}),this.canvasRef=(t=>{this.canvas=t||null,this.ctx=t?t.getContext("2d"):null,this.props.canvasRef&&this.props.canvasRef(this.canvas),this.props.contextRef&&this.props.contextRef(this.ctx)}),e}componentDidMount(){this.disposeRenderer=Object(y.e)(this.draw,{scheduler:t=>window.requestAnimationFrame(()=>t())})}componentDidUpdate(){this.draw()}componentWillUnmount(){this.disposeRenderer&&this.disposeRenderer()}render(){const t=this.props,e=t.className,n=t.style,o=t.width,s=t.height,r=t.onMouseEnter,a=t.onMouseLeave,l=t.onMouseDown,h=t.onMouseMove,c=t.onMouseUp,d=t.onClick,p=window.devicePixelRatio;return i.createElement("canvas",{ref:this.canvasRef,className:e,style:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){gt(t,e,n[e])})}return t}({},n,{width:o,height:s}),width:o*p,height:s*p,onMouseEnter:r,onMouseLeave:a,onMouseDown:l,onMouseMove:h,onMouseUp:c,onClick:d})}});var yt=Z(_(Object(d.a)(class extends i.Component{constructor(...t){var e;return e=super(...t),this.draw=(t=>{const e=this.props,n=e.viewport,i=e.draw,o=n.panX,s=n.panY,r=n.zoom;t.translate(o,s),t.scale(r,r),i(t,n)}),e}render(){const t=this.props,e=t.viewport,n=t.cursor,o=t.canvasRef,s=t.contextRef,r=e.pxWidth,a=e.pxHeight,l=e.left,h=e.top;return i.createElement(Pt,{style:{position:"absolute",left:l,top:h,cursor:null==n?void 0:n},draw:this.draw,width:r,height:a,canvasRef:o,contextRef:s})}})));var ft=class extends o.a.Component{constructor(...t){var e;return e=super(...t),this.draw=((t,e)=>{this.drawOutline(t,e),this.drawBasePoint(t,e)}),e}drawOutline(t,{px:e,sceneWidth:n,sceneHeight:i}){t.strokeStyle="rgba(0, 0, 0, 0.5)",t.lineWidth=e,t.strokeRect(0,0,n,i)}drawBasePoint(t,{basePoint:e,px:n,top:i,left:o,windowWidth:s,windowHeight:r,bottom:a,right:l,screenCoordsToSceneCoords:h}){const c=h(o,i),d=h(s-l,r-a);t.beginPath(),t.moveTo(c.x,e.y),t.lineTo(d.x,e.y),t.moveTo(e.x,c.y),t.lineTo(e.x,d.y),t.lineWidth=n,t.strokeStyle=wt.a.A400,t.stroke()}render(){return o.a.createElement(yt,{draw:this.draw})}},bt=n(232),Ct=n.n(bt),St=n(233),Et=n.n(St);var kt=Z(_(Object(I.withStyles)({canvas:{position:"absolute",top:0,left:0}})(Object(d.a)(class extends o.a.Component{constructor(...t){var e;return e=super(...t),this.draw=(t=>{const e=this.props,n=e.viewport,i=e.width,o=e.height,s=e.draw;t.translate(i/2,o/2),s(t,n)}),e}render(){const t=this.props,e=t.width,n=t.height,i=t.sceneX,s=t.sceneY,r=t.viewport,a=t.classes,l=r.panX,h=r.panY,c=r.zoom,d=i*c+l-e/2+r.left,p=s*c+h-n/2+r.top;return o.a.createElement(Pt,{draw:this.draw,className:a.canvas,width:e,height:n,style:{transform:`translate(${d}px, ${p}px)`}})}}))));var xt=Z(_(Object(d.a)(class extends o.a.Component{constructor(...t){var e;return e=super(...t),this.draw=((t,{nearestKeyPoint:e,keyboard:n})=>{const i=e===this.props.keyPoint;(n.isPressed("ctrl")||i)&&(t.beginPath(),t.arc(0,0,10,0,2*Math.PI,!0),t.moveTo(-15,0),t.lineTo(-5,0),t.moveTo(5,0),t.lineTo(15,0),t.moveTo(0,-15),t.lineTo(0,-5),t.moveTo(0,5),t.lineTo(0,15),i&&(t.moveTo(-14.5,-2.5),t.lineTo(-14.5,2.5),t.moveTo(14.5,-2.5),t.lineTo(14.5,2.5),t.moveTo(-2.5,-14.5),t.lineTo(2.5,-14.5),t.moveTo(-2.5,14.5),t.lineTo(2.5,14.5)),t.lineWidth=1,t.strokeStyle=i?Et.a.A700:Ct.a.A400,t.stroke())}),e}render(){const t=this.props.keyPoint;return o.a.createElement(kt,{draw:this.draw,width:30,height:30,sceneX:t.x,sceneY:t.y})}})));var Ot=Z(_(Object(d.a)(class extends o.a.Component{render(){const t=this.props.viewport.scene.keyPointSet;return o.a.createElement(o.a.Fragment,null,t.keyPoints.map(t=>o.a.createElement(xt,{keyPoint:t,key:String(t.id)})))}}))),Dt=n(231),Mt=n.n(Dt),jt=n(4);class Tt{constructor(){this.id=Object(jt.b)(),this.keyPointsById={}}get keyPoints(){return Object.keys(this.keyPointsById).map(t=>this.keyPointsById[t])}addKeyPoint(t){this.keyPointsById[String(t.id)]=t}get(t){return this.keyPointsById[String(t)]||null}has(t){return this.get(t.id)===t}}Object(jt.f)(Tt,"KeyPointSet",[],{keyPointsById:Object(jt.e)(f.a)});var Kt=Object(y.i)(Tt,{keyPointsById:y.n,keyPoints:y.f,addKeyPoint:y.d}),At=n(57);class _t{constructor(){this.id=Object(jt.b)(),this.keyPointSet=void 0,this.pointsByKeyPointId={}}init(t){return this.keyPointSet=t,this}get definedKeyPoints(){return Object.keys(this.pointsByKeyPointId).filter(t=>null!=this.pointsByKeyPointId[t]).map(t=>{const e=this.keyPointSet.get(t);return l()(e,"point must exist"),e})}get thinPlateSplinesX(){const t=this.keyPointSet.keyPoints,e=t.map(t=>this.getAtKeyPoint(t).x);return new At.a(t,e)}get thinPlateSplinesY(){const t=this.keyPointSet.keyPoints,e=t.map(t=>this.getAtKeyPoint(t).y);return new At.a(t,e)}getAtKeyPoint(t){if(l()(this.keyPointSet.has(t),"key point must be in scene"),null!=this.pointsByKeyPointId[String(t.id)])return this.pointsByKeyPointId[String(t.id)];const e=t.findNearest(this.definedKeyPoints);return l()(e,"nearest point must be found"),this.pointsByKeyPointId[String(e.id)]}setAtKeyPoint(t,e){l()(this.keyPointSet.has(t),"keyPoint must exist in scene"),this.pointsByKeyPointId[String(t.id)]=e}getAtBasePoint(t){return new f.a(this.thinPlateSplinesX.getValue(t),this.thinPlateSplinesY.getValue(t))}transform(t){const e=(new _t).init(this.keyPointSet);return this.definedKeyPoints.forEach(n=>{e.setAtKeyPoint(n,t(this.getAtKeyPoint(n),n))}),e}add(t){return this.transform((e,n)=>e.add(t.getAtKeyPoint(n)))}subtract(t){return this.transform((e,n)=>e.subtract(t.getAtKeyPoint(n)))}scale(t){return this.transform(e=>e.scale(t))}}Object(jt.f)(_t,"MagicPointThingy",[],{keyPointSet:Object(jt.c)(Kt),pointsByKeyPointId:Object(jt.e)(f.a)});var It=Object(y.i)(_t,{keyPointSet:y.n,pointsByKeyPointId:y.n,setAtKeyPoint:y.d,definedKeyPoints:y.f,thinPlateSplinesX:y.f,thinPlateSplinesY:y.f});class Ut{constructor(){this.id=Object(jt.b)(),this.originPoint=void 0,this._leadingControlPointRelative=null,this._followingControlPointRelative=null,this.areControlPointsMirrored=!0}init(t){return this.originPoint=t,this}get leadingControlPointRelative(){return this._leadingControlPointRelative}set leadingControlPointRelative(t){this._leadingControlPointRelative=t}get followingControlPointRelative(){if(this.areControlPointsMirrored){const t=this.leadingControlPointRelative;return t?t.scale(-1):null}return this._followingControlPointRelative}set followingControlPointRelative(t){this.areControlPointsMirrored?this.leadingControlPointRelative=t?t.scale(-1):null:this._followingControlPointRelative=t}get leadingControlPointGlobal(){const t=this.leadingControlPointRelative;return t?this.originPoint.add(t):null}set leadingControlPointGlobal(t){this.leadingControlPointRelative=t?t.subtract(this.originPoint):null}get followingControlPointGlobal(){const t=this.followingControlPointRelative;return t?this.originPoint.add(t):null}set followingControlPointGlobal(t){this.followingControlPointRelative=t?t.subtract(this.originPoint):null}}Object(jt.f)(Ut,"ShapePoint",["areControlPointsMirrored"],{originPoint:Object(jt.c)(It),_leadingControlPointRelative:Object(jt.c)(It),_followingControlPointRelative:Object(jt.c)(It)});var Rt=Object(y.i)(Ut,{origin:y.n,_leadingControlPointRelative:y.n,_followingControlPointRelative:y.n,areControlPointsMirrored:y.n,leadingControlPointGlobal:y.f,leadingControlPointRelative:y.f,followingControlPointGlobal:y.f,followingControlPointRelative:y.f});const Bt=(t,{x:e,y:n},i)=>{const o=i/2;t.moveTo(e-o,n-o),t.lineTo(e+o,n-o),t.lineTo(e+o,n+o),t.lineTo(e-o,n+o),t.lineTo(e-o,n-o)},zt=(t,e,n)=>{t.beginPath(),Bt(t,e,n),t.globalCompositeOperation="destination-out",t.fill(),t.globalCompositeOperation="source-over",t.stroke()},Wt=(t,e,n)=>{const i=new Path2D;return t.forEach((n,o)=>{const s=n.originPoint.getAtBasePoint(e),r=s.x,a=s.y;if(0===o)i.moveTo(r,a);else{const s=t[o-1].leadingControlPointGlobal,l=n.followingControlPointGlobal;if(s&&l){const t=s.getAtBasePoint(e),n=t.x,o=t.y,h=l.getAtBasePoint(e),c=h.x,d=h.y;i.bezierCurveTo(n,o,c,d,r,a)}else if(s){const t=s.getAtBasePoint(e),n=t.x,o=t.y;i.quadraticCurveTo(n,o,r,a)}else if(l){const t=l.getAtBasePoint(e),n=t.x,o=t.y;i.quadraticCurveTo(n,o,r,a)}else i.lineTo(r,a)}}),n&&i.closePath(),i},Lt=5,$t=150;var Nt=Z(_(class extends i.Component{constructor(...t){var e;return e=super(...t),this._unsubscribes=[],this._drag=null,this.handlePointerDown=(()=>{const t=this.props.viewport.pointer.scenePosition;l()(t,"viewport must have position to be pressed"),this._drag={startTime:Date.now(),startScenePosition:t.clone(),hasNotifiedStart:!1,asyncDrag:this.startAsyncDrag()},this.props.onPointerDown&&this.props.onPointerDown(this.props.viewport)}),this.handlePointerMove=(()=>{const t=this.props.viewport,e=t.pointer.screenPosition;l()(e,"viewport must have position for pointermove");const n=this._drag;if(n){if(!n.hasNotifiedStart){const i=t.sceneCoordsToScreenCoords(n.startScenePosition.x,n.startScenePosition.y);(n.startTime+$t>Date.now()||e.distanceTo(i)>Lt)&&(this.props.onDragStart&&this.props.onDragStart(t),n.hasNotifiedStart=!0,n.asyncDrag&&n.asyncDrag.notifyStart())}n.hasNotifiedStart&&(this.props.onDragMove&&this.props.onDragMove(this.props.viewport),n.asyncDrag&&n.asyncDrag.notifyMove())}this.props.onPointerMove&&this.props.onPointerMove(this.props.viewport)}),this.handlePointerUp=(()=>{const t=this._drag;l()(t,"drag must be defined"),t.hasNotifiedStart?this.props.onDragEnd&&this.props.onDragEnd(this.props.viewport):this.props.onClick&&this.props.onClick(this.props.viewport),this.props.onPointerUp&&this.props.onPointerUp(this.props.viewport),t.asyncDrag&&t.asyncDrag.notifyEnd()}),e}componentDidMount(){const t=this.props.viewport.pointer;this._unsubscribes.push(t.onPointerDown(this.handlePointerDown)),this._unsubscribes.push(t.onPointerMove(this.handlePointerMove)),this._unsubscribes.push(t.onPointerUp(this.handlePointerUp))}componentWillUnmount(){this._unsubscribes.forEach(t=>t()),this._unsubscribes=[]}startAsyncDrag(){const t=this.props,e=t.viewport,n=t.onDragAsync;if(!n)return null;let i=t=>{},o=t=>{};return n(e,new Promise(t=>{i=t}),()=>new Promise(t=>{o=t})),{notifyStart:()=>{i(!1)},notifyMove:()=>{o(!0)},notifyEnd:()=>{i(!0),o(!1)}}}render(){return null}}));var Ht=class extends o.a.Component{constructor(...t){var e;return e=super(...t),this.draw=((t,e)=>{const n=e.pointer.hoveredItem;n&&this.drawSelectionItem(t,n,Mt.a.A400,e)}),this.handleClick=(t=>{const e=t.pointer.hoveredItem;console.log(e)}),this.handleDragAsync=(async(t,e,n)=>{const i=t.pointer.hoveredItem;if(i)switch(i.type){case"MagicPointThingySelectionItem":return await this.handleMagicPointThingyDrag(i,t,e,n);case"ShapeSelectionItem":return await this.handleShapeDrag(i,t,e,n);default:throw new Error(`Unknown selection type: ${i.type}`)}}),e}drawSelectionItem(t,e,n,i){switch(e.type){case"ShapeSelectionItem":return this.drawShapeSelectionItem(t,e,n,i);case"MagicPointThingySelectionItem":return this.drawMagicPointThingySelectionItem(t,e,n,i);default:throw new Error(`Unknown selection item type: ${e.type}`)}}drawShapeSelectionItem(t,{shape:e},n,i){this.drawShapeOutline(t,e,n,i),this.drawPointOutlines(t,e,n,i)}drawMagicPointThingySelectionItem(t,{point:e,inShape:n},i,o){this.drawShapeOutline(t,n,i,o),this.drawPointOutlines(t,n,i,o),t.beginPath(),t.fillStyle=i;const s=o.px,r=o.basePoint;Bt(t,e.originPoint.getAtBasePoint(r),5*s),t.fill()}drawShapeOutline(t,e,n,{px:i,basePoint:o}){t.lineWidth=i,t.strokeStyle=n,t.stroke(e.getCanvasPathAtBasePoint(o))}drawPointOutlines(t,e,n,{px:i,basePoint:o}){t.lineWidth=i,t.strokeStyle=n,e.points.forEach(e=>{zt(t,e.originPoint.getAtBasePoint(o),5*i)})}async handleMagicPointThingyDrag(t,e,n,i){if(!await n)for(;await i();){const n=e.pointer.scenePosition;n&&t.point.originPoint.setAtKeyPoint(e.nearestKeyPoint,n)}}async handleShapeDrag(t,e,n,i){let o=e.pointer.scenePosition;if(l()(o,"viewport pointer must be active"),!await n)for(;await i();){const n=e.pointer.scenePosition;l()(n,"viewport pointer must be active");const i=n.subtract(o);t.shape.points.forEach(t=>{t.originPoint.setAtKeyPoint(e.nearestKeyPoint,t.originPoint.getAtKeyPoint(e.nearestKeyPoint).add(i))}),o=n}}render(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(yt,{draw:this.draw}),o.a.createElement(Nt,{onClick:this.handleClick,onDragAsync:this.handleDragAsync}))}},Vt=n(230),Xt=n.n(Vt);class Yt{constructor(){this.id=Object(jt.b)(),this.strokeWidth=1,this.strokeColor="black",this.fillColor=null}drawCurrentContextPath(t){null!==this.fillColor&&(t.fillStyle=this.fillColor,t.fill()),null!==this.strokeColor&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke())}drawPath(t,e){null!==this.fillColor&&(t.fillStyle=this.fillColor,t.fill(e)),null!==this.strokeColor&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke(e))}}Object(jt.f)(Yt,"ShapeStyle",["strokeWidth","strokeColor","fillColor"]);var Ft=Object(y.i)(Yt,{strokeWidth:y.n,strokeColor:y.n,fillColor:y.n});class Gt{constructor(){this.id=Object(jt.b)(),this.style=new Ft,this.points=[],this.isClosed=!1}addPoint(t){this.points.push(t)}close(){this.isClosed=!0}getCanvasPathAtBasePoint(t){return Wt(this.points,t,this.isClosed)}drawToCanvasAtBasePoint(t,e){this.style.drawPath(t,this.getCanvasPathAtBasePoint(e))}}Object(jt.f)(Gt,"Shape",["isClosed"],{style:Object(jt.c)(Ft),points:Object(jt.d)(It)});var qt=Object(y.i)(Gt,{style:y.n,points:y.n,isClosed:y.n});var Jt=_(Object(d.a)(class extends o.a.Component{constructor(...t){var e;return e=super(...t),this.liveState=Object(y.n)({targetShape:null}),this.draw=((t,{nearestKeyPoint:e,px:n})=>{const i=this.getTargetScenePoints(),o=i.shapePoints,s=i.isClosed;t.lineWidth=n,t.strokeStyle=Xt.a.A400,t.stroke(Wt(o,e,s)),o.forEach(i=>{zt(t,i.originPoint.getAtBasePoint(e),5*n)})}),this.handleDrag=(async({pointer:t,editor:e,nearestKeyPoint:n},i,o)=>{const s=t.scenePosition;l()(s,"pointer must be active");const r=this.getOrCreateTargetShape(),a=this.shouldSnapClosed();let h;if(a)h=r.points[0],r.close();else{const t=e.scene.createMagicPointThingy();t.setAtKeyPoint(n,s),h=(new Rt).init(t),r.addPoint(h)}if(!await i)for(;await o();){const i=h.leadingControlPointGlobal||e.scene.createMagicPointThingy();l()(t.scenePosition,"scenePosition must be set"),i.setAtKeyPoint(n,t.scenePosition),h.leadingControlPointGlobal=i}a&&(this.liveState.targetShape=null)}),e}shouldSnapClosed(){const t=this.props.viewport,e=t.nearestKeyPoint,n=t.pointer,i=t.sceneCoordsToScreenCoords,o=n.screenPosition;if(!o)return!1;const s=this.liveState.targetShape&&this.liveState.targetShape.points;if(!s||s.length<2)return!1;const r=s[0].originPoint.getAtKeyPoint(e);return i(r.x,r.y).distanceTo(o)<7}getTargetScenePoints(){const t=this.props.viewport,e=t.pointer,n=t.editor,i=t.nearestKeyPoint,o=this.liveState.targetShape,s=e.scenePosition,r=o?o.points:[];if(s){if(this.shouldSnapClosed())return{shapePoints:r,isClosed:!0};const t=n.scene.createMagicPointThingy();return t.setAtKeyPoint(i,s),{shapePoints:[...r,(new Rt).init(t)],isClosed:!1}}return{shapePoints:r,isClosed:!1}}getOrCreateTargetShape(){if(this.liveState.targetShape)return this.liveState.targetShape;const t=new qt;return this.props.viewport.editor.scene.addShape(t),this.liveState.targetShape=t,t}render(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(yt,{draw:this.draw}),o.a.createElement(Nt,{onDragAsync:this.handleDrag}))}}));var Qt=Z(_(Object(d.a)(class extends o.a.Component{render(){const t=this.props.viewport.editor.tool;switch(t){case"SELECT":return o.a.createElement(Ht,null);case"PEN":return o.a.createElement(Jt,null);default:throw new Error(`unknown tool: ${t}`)}}})));var Zt=Object(d.a)(class extends o.a.Component{constructor(...t){var e;return e=super(...t),this.draw=((t,{basePoint:e})=>{this.props.shape.drawToCanvasAtBasePoint(t,e)}),e}render(){return o.a.createElement(yt,{draw:this.draw})}});var te=Z(_(Object(d.a)(class extends o.a.Component{render(){const t=this.props.viewport.editor.scene;return o.a.createElement(o.a.Fragment,null,t.shapes.map((t,e)=>o.a.createElement(Zt,{shape:t,key:e})))}})));var ee=Z(_(class extends o.a.Component{constructor(...t){var e;return e=super(...t),this._unsubscribes=[],this.handlePointerMove=(({keyboard:t,pointer:e,basePoint:n})=>{t.isPressed("ctrl")&&e.scenePosition&&n.set(e.scenePosition)}),this.handleCtrlDown=(()=>{const t=this.props.viewport,e=t.pointer,n=t.basePoint;e.scenePosition&&n.set(e.scenePosition)}),this.handleCtrlUp=(()=>{const t=this.props.viewport,e=t.basePoint,n=t.nearestKeyPoint;e.set(n)}),e}render(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(Nt,{onPointerMove:this.handlePointerMove}),o.a.createElement(pt,{name:"ctrl",onDown:this.handleCtrlDown,onUp:this.handleCtrlUp}))}}));var ne=Object(d.a)(class extends o.a.Component{render(){const t=this.props.editor;return o.a.createElement(o.a.Fragment,null,o.a.createElement($,null),o.a.createElement(mt,{editor:t}),o.a.createElement(tt,{editor:t}),o.a.createElement(A,{editor:t,style:{position:"absolute",top:64,left:48,right:300,bottom:0}},o.a.createElement(te,null),o.a.createElement(ft,null),o.a.createElement(ee,null),o.a.createElement(Ot,null),o.a.createElement(Qt,null)))}});class ie{constructor(){this.id=Object(jt.b)(),this.width=void 0,this.height=void 0,this.keyPointSet=void 0,this.shapes=[]}static deserialize(t){const e=Object(jt.a)(t);return l()(e instanceof ie,"deserialized object is not Scene"),e}init(t,e){return this.width=t,this.height=e,this.keyPointSet=new Kt,this.keyPointSet.addKeyPoint(new f.a(.25*t,.25*e)),this.keyPointSet.addKeyPoint(new f.a(.75*t,.25*e)),this.keyPointSet.addKeyPoint(new f.a(.75*t,.75*e)),this.keyPointSet.addKeyPoint(new f.a(.25*t,.75*e)),this}addShape(t){this.shapes.push(t)}serialize(){return Object(jt.g)(this)}createMagicPointThingy(){return(new It).init(this.keyPointSet)}}Object(jt.f)(ie,"Scene",["width","height"],{keyPointSet:Object(jt.c)(Kt),shapes:Object(jt.d)(qt)});var oe=Object(y.i)(ie,{width:y.n,height:y.n,shapes:y.n});window.Scene=ie;const se="drag-animate.autosave";class re{static fromAutoSave(t){try{const e=localStorage.getItem(se);l()(null!=e,"no autosave present");const n=JSON.parse(e),i=oe.deserialize(n);return new re(i)}catch(e){return console.warn(`Could not resore from autosave: ${e.message}`),new re(t())}}constructor(t){this.tool=st.SELECT,this.scene=void 0,this.commands={replaceDocumentWithNew:(t=200,e=100)=>{this.scene=(new oe).init(t,e)}},this.scene=t,Object.keys(this.commands).forEach(t=>{this.commands[t]=Object(y.d)(`Editor.commands.${t}`,this.commands[t])})}startAutosaving(){return Object(y.e)(()=>{try{const t=this.scene.serialize(),e=JSON.stringify(t);localStorage.setItem(se,e),console.log("Saved.")}catch(t){console.warn(`couldnt autosave: ${t.message}`)}},{delay:2500})}setTool(t){this.tool=t}}var ae=Object(y.i)(re,{scene:y.n,tool:y.n,hoveredShapes:y.n,setTool:y.d,setHovers:y.d});k.setup();const le=document.getElementById("root");l()(le,"root must exist");const he=ae.fromAutoSave(()=>(new oe).init(200,100));he.startAutosaving(),window.editor=he,r.a.render(o.a.createElement(o.a.Fragment,null,o.a.createElement(c.a,null),o.a.createElement(ne,{editor:he})),le)}},[[228,0,1]]]);
//# sourceMappingURL=main.e36031b5.chunk.js.map