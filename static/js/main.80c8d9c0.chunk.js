(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{137:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return r});var o=n(5),i=n.n(o);n(19);n(229);var s=function(){var e,n,o,s=function(t,e){var n=function(t,e){var n=0;if(!t.length)return Math.sqrt(Math.pow(t-e,2));for(var o=0;o<t.length;o++)n+=Math.pow(t[o]-e[o],2);return Math.sqrt(n)}(t,e);return 0===n?0:Math.pow(n,2)*Math.log(n)};this.compile=function(r,a){i()(r&&r.length,"bad centers array :/"),e=r.map(function(t){return t}),o=a.map(function(t){return t});for(var l=[],c=[],h=[],d=[],p=0;p<e.length;p++){c=[],d=[1];for(var u=0;u<e[p].length;u++)d.push(e[p][u]);for(var g=0;g<e.length;g++)c.push(s(e[p],e[g]));h.push(d),l.push(c.concat(d))}var m=t.$M(h).transpose().elements.map(function(t){for(var e=t.length;e<l[0].length;e++)t.push(0);return t});for(p=0;p<m.length;p++)l.push(m[p]),o.push(0);n=this._solve(o,l),i()(n,"rbf failed to compile with given centers./nCenters must be unique :/")},this._solve=function(e,n){var o=t.$M(n),i=t.$V(e);if(o=o.inverse())return o.multiply(i)},this.getValue=function(t){var o=0,i=0;for(i=0;i<e.length;i++)o+=Number(n.elements[i])*s(t,e[i]);for(o+=Number(n.elements[e.length]),i=0;i<t.length;i++)o+=t[i]*Number(n.elements[e.length+(i+1)]);return o},this.getValues=function(t,e){setTimeout(function(){var n=t.map(function(t){return this.getValue(t)},this);e(null,{points:t,ys:n})}.bind(this),0)}};class r{constructor(t,e){this.tps=new s,this.tps.compile(t.map(({x:t,y:e})=>[t,e]),e)}getValue(t){return this.tps.getValue([t.x,t.y])}}}).call(this,n(26))},19:function(t,e,n){"use strict";var o=n(1),i=n(9);class s{constructor(t,e){this.id=Object(i.b)(),this.x=void 0,this.y=void 0,this.x=t,this.y=e}clone(){return new s(this.x,this.y)}distanceTo(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}setXY(t,e){this.x=t,this.y=e}set(t){this.x=t.x,this.y=t.y}findNearest(t){let e=null,n=1/0;return t.forEach(t=>{const o=this.distanceTo(t);o<n&&(e=t,n=o)}),e}add(t){return new s(this.x+t.x,this.y+t.y)}subtract(t){return new s(this.x-t.x,this.y-t.y)}scale(t){return new s(this.x*t,this.y*t)}}Object(i.f)(s,"Vector2",["x","y"]),Object(o.i)(s,{x:o.n,y:o.n}),e.a=s},225:function(t,e,n){"use strict";n.r(e);var o=n(0),i=n.n(o),s=n(18),r=n.n(s),a=n(5),l=n.n(a),c=n(558),h=n.n(c),d=n(16),p=n(219),u=n.n(p);const g=()=>document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,m={position:"fixed",top:"0px",left:"0px",width:"100%",height:"100%",zIndex:"10000",touchAction:"none"};class w{constructor({down:t,move:e,up:n}={}){this.onDown=null,this.onMove=null,this.onUp=null,this.attachedTo=null,this.cover=void 0,this.onDown=t,this.onMove=e,this.onUp=n;const o=document.createElement("div");Object.assign(o.style,m),o.setAttribute("touch-action","none"),this.cover=o}attach(){if(!this.attachedTo){const t=g()||document.body;l()(null!=t,"target must exist"),t.appendChild(this.cover),this.attachedTo=t,this.attachEvents()}}remove(){const t=this.attachedTo;t&&(this.attachedTo=null,this.removeEvents(),t.removeChild(this.cover))}attachEvents(){this.onDown&&this.cover.addEventListener("pointerdown",this.onDown,!1),this.onMove&&this.cover.addEventListener("pointermove",this.onMove,!1),this.onUp&&this.cover.addEventListener("pointerup",this.onUp,!1)}removeEvents(){this.onDown&&this.cover.removeEventListener("pointerdown",this.onDown),this.onMove&&this.cover.removeEventListener("pointermove",this.onMove),this.onUp&&this.cover.removeEventListener("pointerup",this.onUp)}}var P=n(47),v=n.n(P),y=n(1),f=n(19);var b=Object(y.i)(class extends v.a{constructor(t){super(),this.viewport=void 0,this.screenPosition=null,this.isDown=!1,this.viewport=t}get isActive(){return null!==this.screenPosition}get scenePosition(){const t=this.screenPosition;return t?this.viewport.screenCoordsToSceneCoords(t.x,t.y):null}setPosition(t,e){this.screenPosition?this.screenPosition.setXY(t,e):this.screenPosition=new f.a(t,e)}clearPosition(){this.screenPosition=null}triggerPointerDown(){this.isDown=!0,this.emit("pointerDown")}triggerPointerMove(){this.emit("pointerMove")}triggerPointerUp(){this.isDown=!1,this.emit("pointerUp")}onPointerDown(t){const e=()=>t(this.viewport);return this.addListener("pointerDown",e),()=>{this.removeListener("pointerDown",e)}}onPointerMove(t){const e=()=>t(this.viewport);return this.addListener("pointerMove",e),()=>{this.removeListener("pointerMove",e)}}onPointerUp(t){const e=()=>t(this.viewport);return this.addListener("pointerUp",e),()=>{this.removeListener("pointerUp",e)}}get hoveredItem(){return this.scenePosition?this.viewport.getItemAtSceneCoord(this.scenePosition):null}},{isDown:y.n,screenPosition:y.n,scenePosition:y.f,isActive:y.f,hoveredItem:y.f,setPosition:y.d,triggerPointerDown:y.d,triggerPointerMove:y.d,triggerPointerUp:y.d}),C=n(39),S=n.n(C);class E{constructor(){this._events=new v.a,this._isPressedByKeyCode={},this.handleKeyDown=(t=>{this._isPressedByKeyCode[t.keyCode]=!0,this._events.emit(`keyDown:${t.keyCode}`)}),this.handleKeyUp=(t=>{this._isPressedByKeyCode[t.keyCode]=!1,this._events.emit(`keyUp:${t.keyCode}`)})}setup(){window.addEventListener("keydown",this.handleKeyDown,!1),window.addEventListener("keyup",this.handleKeyUp,!1)}teardown(){window.removeEventListener("keydown",this.handleKeyDown,!1),window.removeEventListener("keyup",this.handleKeyUp,!1)}keyCodeOrNameToKeyCode(t){return"number"===typeof t?t:S()(t)}isPressed(t){const e=this.keyCodeOrNameToKeyCode(t);return!!this._isPressedByKeyCode[e]}onKeyDown(t,e){const n=this.keyCodeOrNameToKeyCode(t),o=()=>e();return this._events.addListener(`keyDown:${n}`,o),()=>{this._events.removeListener(`keyDown:${n}`,o)}}onKeyUp(t,e){const n=this.keyCodeOrNameToKeyCode(t),o=()=>e();return this._events.addListener(`keyUp:${n}`,o),()=>{this._events.removeListener(`keyUp:${n}`,o)}}}Object(y.i)(E,{_isPressedByKeyCode:y.n,handleKeyDown:y.d,handleKeyUp:y.d});var k=new E;const x=15,O=document.createElement("canvas").getContext("2d");var D=Object(y.i)(class extends v.a{constructor(t){super(),this.keyboard=k,this.top=0,this.left=0,this.bottom=0,this.right=0,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.scale=window.devicePixelRatio||1,this.editor=void 0,this.basePoint=new f.a(0,0),this.pointer=new b(this),this.sceneCoordsToScreenCoords=((t,e)=>new f.a(t*this.zoom+this.panX+this.left,e*this.zoom+this.panY+this.top)),this.screenCoordsToSceneCoords=((t,e)=>new f.a((t-this.left-this.panX)/this.zoom,(e-this.top-this.panY)/this.zoom)),this.editor=t,this.basePoint.set(t.scene.keyPointSet.keyPoints[0])}get sceneWidth(){return this.editor.scene.width}get sceneHeight(){return this.editor.scene.height}get pxWidth(){return this.windowWidth-this.left-this.right}get pxHeight(){return this.windowHeight-this.top-this.bottom}get zoom(){const t=this.pxWidth-2*x,e=this.pxHeight-2*x;return Math.min(t/this.sceneWidth,e/this.sceneHeight)}get panX(){const t=this.pxWidth-2*x;return this.zoom*this.sceneWidth<t?x+(t/2-this.zoom*this.sceneWidth/2):x}get panY(){const t=this.pxHeight-2*x;return this.zoom*this.sceneHeight<t?x+(t/2-this.zoom*this.sceneHeight/2):x}get px(){return 1/this.zoom}get nearestKeyPoint(){const t=this.basePoint.findNearest(this.editor.scene.keyPointSet.keyPoints);return l()(t,"nearest must be found"),t}get scene(){return this.editor.scene}setSize(t,e,n,o,i,s,r){this.windowWidth=t,this.windowHeight=e,this.scale=n,this.left=o,this.top=i,this.right=s,this.bottom=r}getItemAtSceneCoord(t){const e=8*this.px;O.lineWidth=e;for(const n of this.editor.scene.shapes){for(const i of n.points)if(t.distanceTo(i.originPoint.getAtBasePoint(this.basePoint))<e)return{type:"MagicPointThingySelectionItem",point:i,inShape:n};const o=n.getCanvasPathAtBasePoint(this.basePoint);if(O.isPointInStroke(o,t.x,t.y))return{type:"ShapeSelectionItem",shape:n}}return null}},{windowWidth:y.n,windowHeight:y.n,scale:y.n,top:y.n,left:y.n,bottom:y.n,right:y.n,editor:y.n,pointer:y.n,sceneWidth:y.f,sceneHeight:y.f,pxWidth:y.f,pxHeight:y.f,zoom:y.f,panX:y.f,panY:y.f,px:y.f,scene:y.f,nearestKeyPoint:l.a,setSize:y.d});const T=o.createContext(null),j=T.Provider,M=T.Consumer,K=({children:t})=>o.createElement(M,null,e=>(l()(e,"Viewport must exist"),t(e)));class A extends o.Component{constructor(...t){var e;return e=super(...t),this.state={viewport:null},this.sizer=null,this.pointableCover=void 0,this.isPointerDown=!1,this.handleResize=(()=>{this.setViewportSize(this.state.viewport)}),this.sizerRef=(t=>{this.sizer=t}),this.handleMouseDown=(()=>{const t=this.state.viewport;l()(t,"viewport must exist"),this.isPointerDown=!0,this.pointableCover.attach(),t.pointer.triggerPointerDown()}),this.handleMouseMove=(t=>{const e=this.state.viewport;l()(e,"viewport must exist"),e.pointer.setPosition(t.clientX,t.clientY),e.pointer.triggerPointerMove()}),this.handleMouseUp=(()=>{const t=this.state.viewport;l()(t,"viewport must exist"),this.isPointerDown=!1,this.pointableCover.remove(),t.pointer.triggerPointerUp();const e=t.pointer.screenPosition;l()(e,"viewport pointer must be active"),(t.left>e.x||e.x>t.windowWidth-t.right||t.top>e.y||e.y>t.windowHeight-t.bottom)&&t.pointer.clearPosition()}),this.handleMouseLeave=(()=>{const t=this.state.viewport;l()(t,"viewport must exist"),this.isPointerDown||t.pointer.clearPosition()}),e}componentDidMount(){this.pointableCover=new w({down:this.handleMouseDown,move:this.handleMouseMove,up:this.handleMouseUp});const t=new D(this.props.editor);this.setState({viewport:t}),this.setViewportSize(t),window.addEventListener("resize",this.handleResize)}componentDidUpdate(){this.setViewportSize(this.state.viewport)}componentWillUnmount(){this.pointableCover.remove(),window.removeEventListener("resize",this.handleResize)}setViewportSize(t){const e=this.sizer;l()(e,"container must be set"),l()(t,"viewport must be set");const n=window.innerWidth,o=window.innerHeight,i=window.devicePixelRatio||1,s=e.getBoundingClientRect(),r=s.left,a=s.top,c=s.right,h=s.bottom;t.setSize(n,o,i,r,a,n-c,o-h)}renderViewport(t){const e=this.props,n=e.children,i=e.editor;return l()(t.editor===i,"prop editor must not change"),o.createElement(j,{value:t},n)}render(){const t=this.props,e=t.style,n=t.children,i=t.editor,s=this.state.viewport;return s&&l()(s.editor===i,"prop editor must not change"),o.createElement(o.Fragment,null,s&&o.createElement(j,{value:s},n),o.createElement("div",{ref:this.sizerRef,style:e,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseLeave}))}}const I=t=>{var e,n;return n=e=class extends o.Component{render(){return o.createElement(K,null,e=>o.createElement(t,Object.assign({},this.props,{viewport:e})))}},e.displayName=`withViewport(${u()(t)})`,n};var _=n(32),R=n(571),B=n.n(R),U=n(570),z=n.n(U),W=n(217),L=n.n(W);var N=Object(_.withStyles)(t=>({appBar:{zIndex:t.zIndex.drawer+1}}))(({classes:t})=>i.a.createElement(B.a,{position:"absolute",className:t.appBar},i.a.createElement(z.a,null,i.a.createElement(L.a,{variant:"title",color:"inherit"},"Drag Animate")))),$=n(221),F=n.n($);var G=t=>t,H=n(62),V=n.n(H),X=n(222),Y=n.n(X),q=n(63),J=n.n(q),Q=n(48),Z=n.n(Q),tt=n(224),et=n.n(tt),nt=n(64),ot=n.n(nt),it=n(568),st=n.n(it),rt=n(223),at=n.n(rt),lt=n(567),ct=n.n(lt),ht=n(7),dt=n.n(ht),pt=n(569),ut=n.n(pt),gt=n(215),mt=n.n(gt),wt=n(216),Pt=n.n(wt);const vt=({rgb:t})=>"number"===typeof t.a?`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`:`rgb(${t.r}, ${t.g}, ${t.b})`;var yt=Object(_.withStyles)(t=>({container:{position:"relative"},popper:{zIndex:t.zIndex.tooltip,marginTop:t.spacing.unit},button:{boxShadow:t.shadows[1],"&:active":{boxShadow:t.shadows[3]}}}))(class extends i.a.Component{constructor(...t){var e;return e=super(...t),this.state={anchor:null,isOpen:!1},this.onChange=(t=>{this.props.onChange(vt(t))}),this.onClickButton=(()=>{this.setState(({isOpen:t})=>({isOpen:!t}))}),this.onClose=(()=>{this.setState({isOpen:!1})}),this.buttonRef=(t=>{this.setState({anchor:t||null})}),e}render(){const t=this.props,e=t.value,n=t.classes,o=t.className,s=this.state,r=s.isOpen,a=s.anchor;return i.a.createElement("div",{className:dt()(n.container,o)},i.a.createElement(ut.a,{buttonRef:this.buttonRef,className:n.button,style:{background:e},onClick:this.onClickButton,variant:"fab",mini:!0}," "),a&&i.a.createElement(mt.a,{className:n.popper,open:r,anchorEl:a,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},onClose:this.onClose},i.a.createElement(Pt.a,{color:e,onChangeComplete:this.onChange})))}});var ft=G(Object(_.withStyles)(t=>({gutters:{paddingRight:2*t.spacing.unit},nested:{paddingLeft:2*t.spacing.unit},input:{width:8*t.spacing.unit},item:{height:7*t.spacing.unit}}))(Object(d.a)(Object(y.i)(class extends i.a.Component{constructor(...t){var e;return e=super(...t),this.onToggleStroke=V()(()=>{const t=this.props.shape.style;t.hasStroke=!t.hasStroke},0),this.onToggleFill=V()(()=>{const t=this.props.shape.style;t.hasFill=!t.hasFill},0),this.onChangeStrokeWidth=(t=>{l()(t.currentTarget instanceof HTMLInputElement,"target must be input");const e=parseFloat(t.currentTarget.value);isNaN(e)||(this.props.shape.style.strokeWidth=e)}),this.onChangeStrokeColor=(t=>{this.props.shape.style.strokeColor=t}),this.onChangeFillColor=(t=>{this.props.shape.style.fillColor=t}),e}render(){const t=this.props,e=t.shape,n=t.classes,o=e.style,s=o.hasStroke,r=o.hasFill,a=o.strokeWidth;return i.a.createElement(J.a,{subheader:i.a.createElement(st.a,null,"Shape Properties")},i.a.createElement(Z.a,{classes:{gutters:n.gutters},onClick:this.onToggleStroke,button:!0},i.a.createElement(ot.a,null,"Outline"),i.a.createElement(et.a,null,i.a.createElement(at.a,{checked:s,onChange:this.onToggleStroke}))),i.a.createElement(Y.a,{in:s,timeout:"auto",unmountOnExit:!0},i.a.createElement(J.a,{component:"div",disablePadding:!0,className:n.nested},i.a.createElement(Z.a,null,i.a.createElement(ot.a,null,"Width"),i.a.createElement(ct.a,{className:n.input,type:"number",value:a,onChange:this.onChangeStrokeWidth,inputProps:{step:.1}})),i.a.createElement(Z.a,{className:n.item},i.a.createElement(ot.a,null,"Colour"),i.a.createElement(yt,{value:e.style.strokeColor,onChange:this.onChangeStrokeColor})))),i.a.createElement(Z.a,{classes:{gutters:n.gutters},onClick:this.onToggleFill,button:!0},i.a.createElement(ot.a,null,"Fill"),i.a.createElement(et.a,null,i.a.createElement(at.a,{checked:r,onChange:this.onToggleFill}))),i.a.createElement(Y.a,{in:r,timeout:"auto",unmountOnExit:!0},i.a.createElement(J.a,{component:"div",disablePadding:!0,className:n.nested},i.a.createElement(Z.a,{className:n.item},i.a.createElement(ot.a,null,"Colour"),i.a.createElement(yt,{value:e.style.fillColor,onChange:this.onChangeFillColor})))))}},{onToggleFill:y.d,onToggleOutline:y.d,onChangeStrokeWidth:y.d,onChangeStrokeColor:y.d,onChangeFillColor:y.d}))));const bt=t=>{const e=t.selection;if(!e||e.length<1)return null;const n=e[0];switch(n.type){case"ShapeSelectionItem":return n.shape;case"MagicPointThingySelectionItem":case"ControlPointSelectionItem":return n.inShape;default:throw new Error(`Unknown selection type ${n.type}`)}};var Ct=G(Object(_.withStyles)(t=>({drawerPaper:{width:300},addButton:{position:"absolute",bottom:2*t.spacing.unit,right:2*t.spacing.unit},toolbar:t.mixins.toolbar}))(Object(d.a)(class extends i.a.Component{render(){const t=this.props,e=t.classes,n=t.editor,o=bt(n);return i.a.createElement(F.a,{variant:"permanent",anchor:"right",classes:{paper:e.drawerPaper}},i.a.createElement("div",{className:e.toolbar}),o&&i.a.createElement(ft,{shape:o}))}}))),St=n(564),Et=n.n(St),kt=n(563),xt=n.n(kt);var Ot={SELECT:"SELECT",PEN:"PEN"},Dt=n(565),Tt=n.n(Dt),jt=n(566),Mt=n.n(jt);var Kt=class extends i.a.Component{constructor(...t){var e;return e=super(...t),this._unsubscribes=[],this.handleKeyDown=(()=>{this.props.onDown&&this.props.onDown(k)}),this.handleKeyUp=(()=>{this.props.onUp&&this.props.onUp(k)}),e}componentDidMount(){this.listen()}componentDidUpdate(t){t.name!==this.props.name&&(this.unsubscribe(),this.listen())}listen(){const t=this.props.name;this._unsubscribes.push(k.onKeyDown(t,this.handleKeyDown)),this._unsubscribes.push(k.onKeyUp(t,this.handleKeyUp))}unsubscribe(){this._unsubscribes.forEach(t=>t()),this._unsubscribes=[]}render(){return null}};var At=Object(_.withStyles)(t=>({listItem:{padding:1.5*t.spacing.unit},active:{color:t.palette.primary.light},inactive:{color:t.palette.text.primary},popper:{}}))(Object(d.a)(class extends o.Component{constructor(...t){var e;return e=super(...t),this.handleClick=(()=>{const t=this.props,e=t.editor,n=t.tool;e.setTool(n)}),e}render(){const t=this.props,e=t.name,n=t.shortcutKey,i=t.tool,s=t.editor,r=t.icon,a=t.classes;return o.createElement(o.Fragment,null,o.createElement(Kt,{name:n,onDown:this.handleClick}),o.createElement(Mt.a,{title:`${e} (${n.toUpperCase()})`,placement:"right",classes:{popper:a.popper}},o.createElement(Z.a,{button:!0,classes:{root:dt()(a.listItem,{[a.active]:i===s.tool})},onClick:this.handleClick},o.createElement(Tt.a,{classes:{root:i===s.tool?a.active:a.inactive}},r))))}}));var It=G(Object(_.withStyles)(t=>({drawerPaper:{width:48},toolbar:t.mixins.toolbar}))(Object(d.a)(class extends i.a.Component{render(){const t=this.props,e=t.classes,n=t.editor;return i.a.createElement(F.a,{variant:"permanent",anchor:"left",classes:{paper:e.drawerPaper}},i.a.createElement("div",{className:e.toolbar}),i.a.createElement(J.a,null,i.a.createElement(At,{name:"Select",shortcutKey:"v",tool:Ot.SELECT,icon:i.a.createElement(Et.a,null),editor:n}),i.a.createElement(At,{name:"Pen",shortcutKey:"p",tool:Ot.PEN,icon:i.a.createElement(xt.a,null),editor:n})))}}))),_t=n(562),Rt=n.n(_t);function Bt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ut=Object(d.a)(class extends o.Component{constructor(...t){var e;return e=super(...t),this.canvas=null,this.ctx=null,this.disposeRenderer=null,this.draw=(()=>{const t=this.ctx;if(!t)return;const e=window.devicePixelRatio,n=this.props,o=n.width,i=n.height,s=n.draw;t.save(),t.scale(e,e),t.clearRect(0,0,o,i),s(t),t.restore()}),this.canvasRef=(t=>{this.canvas=t||null,this.ctx=t?t.getContext("2d"):null,this.props.canvasRef&&this.props.canvasRef(this.canvas),this.props.contextRef&&this.props.contextRef(this.ctx)}),e}componentDidMount(){this.disposeRenderer=Object(y.e)(this.draw,{scheduler:t=>window.requestAnimationFrame(()=>t())})}componentDidUpdate(){this.draw()}componentWillUnmount(){this.disposeRenderer&&this.disposeRenderer()}render(){const t=this.props,e=t.className,n=t.style,i=t.width,s=t.height,r=t.onMouseEnter,a=t.onMouseLeave,l=t.onMouseDown,c=t.onMouseMove,h=t.onMouseUp,d=t.onClick,p=window.devicePixelRatio;return o.createElement("canvas",{ref:this.canvasRef,className:e,style:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){Bt(t,e,n[e])})}return t}({},n,{width:i,height:s}),width:i*p,height:s*p,onMouseEnter:r,onMouseLeave:a,onMouseDown:l,onMouseMove:c,onMouseUp:h,onClick:d})}});var zt=G(I(Object(d.a)(class extends o.Component{constructor(...t){var e;return e=super(...t),this.draw=(t=>{const e=this.props,n=e.viewport,o=e.draw,i=n.panX,s=n.panY,r=n.zoom;t.translate(i,s),t.scale(r,r),o(t,n)}),e}render(){const t=this.props,e=t.viewport,n=t.cursor,i=t.canvasRef,s=t.contextRef,r=e.pxWidth,a=e.pxHeight,l=e.left,c=e.top;return o.createElement(Ut,{style:{position:"absolute",left:l,top:c,cursor:null==n?void 0:n},draw:this.draw,width:r,height:a,canvasRef:i,contextRef:s})}})));var Wt=class extends i.a.Component{constructor(...t){var e;return e=super(...t),this.draw=((t,e)=>{this.drawOutline(t,e),this.drawBasePoint(t,e)}),e}drawOutline(t,{px:e,sceneWidth:n,sceneHeight:o}){t.strokeStyle="rgba(0, 0, 0, 0.5)",t.lineWidth=e,t.strokeRect(0,0,n,o)}drawBasePoint(t,{basePoint:e,px:n,top:o,left:i,windowWidth:s,windowHeight:r,bottom:a,right:l,screenCoordsToSceneCoords:c}){const h=c(i,o),d=c(s-l,r-a);t.beginPath(),t.moveTo(h.x,e.y),t.lineTo(d.x,e.y),t.moveTo(e.x,h.y),t.lineTo(e.x,d.y),t.lineWidth=n,t.strokeStyle=Rt.a.A400,t.stroke()}render(){return i.a.createElement(zt,{draw:this.draw})}},Lt=n(560),Nt=n.n(Lt),$t=n(561),Ft=n.n($t);var Gt=G(I(Object(_.withStyles)({canvas:{position:"absolute",top:0,left:0}})(Object(d.a)(class extends i.a.Component{constructor(...t){var e;return e=super(...t),this.draw=(t=>{const e=this.props,n=e.viewport,o=e.width,i=e.height,s=e.draw;t.translate(o/2,i/2),s(t,n)}),e}render(){const t=this.props,e=t.width,n=t.height,o=t.sceneX,s=t.sceneY,r=t.viewport,a=t.classes,l=r.panX,c=r.panY,h=r.zoom,d=o*h+l-e/2+r.left,p=s*h+c-n/2+r.top;return i.a.createElement(Ut,{draw:this.draw,className:a.canvas,width:e,height:n,style:{transform:`translate(${d}px, ${p}px)`}})}}))));var Ht=G(I(Object(d.a)(class extends i.a.Component{constructor(...t){var e;return e=super(...t),this.draw=((t,{nearestKeyPoint:e,keyboard:n})=>{const o=e===this.props.keyPoint;(n.isPressed("ctrl")||o)&&(t.beginPath(),t.arc(0,0,10,0,2*Math.PI,!0),t.moveTo(-15,0),t.lineTo(-5,0),t.moveTo(5,0),t.lineTo(15,0),t.moveTo(0,-15),t.lineTo(0,-5),t.moveTo(0,5),t.lineTo(0,15),o&&(t.moveTo(-14.5,-2.5),t.lineTo(-14.5,2.5),t.moveTo(14.5,-2.5),t.lineTo(14.5,2.5),t.moveTo(-2.5,-14.5),t.lineTo(2.5,-14.5),t.moveTo(-2.5,14.5),t.lineTo(2.5,14.5)),t.lineWidth=1,t.strokeStyle=o?Ft.a.A700:Nt.a.A400,t.stroke())}),e}render(){const t=this.props.keyPoint;return i.a.createElement(Gt,{draw:this.draw,width:30,height:30,sceneX:t.x,sceneY:t.y})}})));var Vt=G(I(Object(d.a)(class extends i.a.Component{render(){const t=this.props.viewport.scene.keyPointSet;return i.a.createElement(i.a.Fragment,null,t.keyPoints.map(t=>i.a.createElement(Ht,{keyPoint:t,key:String(t.id)})))}}))),Xt=n(559),Yt=n.n(Xt),qt=n(220),Jt=n.n(qt),Qt=n(9);class Zt{constructor(){this.id=Object(Qt.b)(),this.keyPointsById={}}get keyPoints(){return Object.keys(this.keyPointsById).map(t=>this.keyPointsById[t])}addKeyPoint(t){this.keyPointsById[String(t.id)]=t}get(t){return this.keyPointsById[String(t)]||null}has(t){return this.get(t.id)===t}}Object(Qt.f)(Zt,"KeyPointSet",[],{keyPointsById:Object(Qt.e)(f.a)});var te=Object(y.i)(Zt,{keyPointsById:y.n,keyPoints:y.f,addKeyPoint:y.d}),ee=n(137);class ne{constructor(){this.id=Object(Qt.b)(),this.keyPointSet=void 0,this.pointsByKeyPointId={}}init(t){return this.keyPointSet=t,this}get definedKeyPoints(){return Object.keys(this.pointsByKeyPointId).filter(t=>null!=this.pointsByKeyPointId[t]).map(t=>{const e=this.keyPointSet.get(t);return l()(e,"point must exist"),e})}get thinPlateSplinesX(){const t=this.keyPointSet.keyPoints,e=t.map(t=>this.getAtKeyPoint(t).x);return new ee.a(t,e)}get thinPlateSplinesY(){const t=this.keyPointSet.keyPoints,e=t.map(t=>this.getAtKeyPoint(t).y);return new ee.a(t,e)}getAtKeyPoint(t){if(l()(this.keyPointSet.has(t),"key point must be in scene"),null!=this.pointsByKeyPointId[String(t.id)])return this.pointsByKeyPointId[String(t.id)];const e=t.findNearest(this.definedKeyPoints);return l()(e,"nearest point must be found"),this.pointsByKeyPointId[String(e.id)]}setAtKeyPoint(t,e){l()(this.keyPointSet.has(t),"keyPoint must exist in scene"),this.pointsByKeyPointId[String(t.id)]=e}getAtBasePoint(t){return new f.a(this.thinPlateSplinesX.getValue(t),this.thinPlateSplinesY.getValue(t))}transform(t){const e=(new ne).init(this.keyPointSet);return this.definedKeyPoints.forEach(n=>{e.setAtKeyPoint(n,t(this.getAtKeyPoint(n),n))}),e}add(t){return this.transform((e,n)=>e.add(t.getAtKeyPoint(n)))}subtract(t){return this.transform((e,n)=>e.subtract(t.getAtKeyPoint(n)))}scale(t){return this.transform(e=>e.scale(t))}}Object(Qt.f)(ne,"MagicPointThingy",[],{keyPointSet:Object(Qt.c)(te),pointsByKeyPointId:Object(Qt.e)(f.a)});var oe=Object(y.i)(ne,{keyPointSet:y.n,pointsByKeyPointId:y.n,setAtKeyPoint:y.d,definedKeyPoints:y.f,thinPlateSplinesX:y.f,thinPlateSplinesY:y.f});class ie{constructor(){this.id=Object(Qt.b)(),this.originPoint=void 0,this._leadingControlPointRelative=null,this._followingControlPointRelative=null,this.areControlPointsMirrored=!0}init(t){return this.originPoint=t,this}get leadingControlPointRelative(){return this._leadingControlPointRelative}set leadingControlPointRelative(t){this._leadingControlPointRelative=t}get followingControlPointRelative(){if(this.areControlPointsMirrored){const t=this.leadingControlPointRelative;return t?t.scale(-1):null}return this._followingControlPointRelative}set followingControlPointRelative(t){this.areControlPointsMirrored?this.leadingControlPointRelative=t?t.scale(-1):null:this._followingControlPointRelative=t}get leadingControlPointGlobal(){const t=this.leadingControlPointRelative;return t?this.originPoint.add(t):null}set leadingControlPointGlobal(t){this.leadingControlPointRelative=t?t.subtract(this.originPoint):null}get followingControlPointGlobal(){const t=this.followingControlPointRelative;return t?this.originPoint.add(t):null}set followingControlPointGlobal(t){this.followingControlPointRelative=t?t.subtract(this.originPoint):null}}Object(Qt.f)(ie,"ShapePoint",["areControlPointsMirrored"],{originPoint:Object(Qt.c)(oe),_leadingControlPointRelative:Object(Qt.c)(oe),_followingControlPointRelative:Object(Qt.c)(oe)});var se=Object(y.i)(ie,{origin:y.n,_leadingControlPointRelative:y.n,_followingControlPointRelative:y.n,areControlPointsMirrored:y.n,leadingControlPointGlobal:y.f,leadingControlPointRelative:y.f,followingControlPointGlobal:y.f,followingControlPointRelative:y.f});function re(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){ae(t,e,n[e])})}return t}function ae(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const le=(t,e,n,o={})=>{const i=re({fill:!1},o).fill;t.beginPath(),((t,{x:e,y:n},o)=>{const i=o/2;t.moveTo(e-i,n-i),t.lineTo(e+i,n-i),t.lineTo(e+i,n+i),t.lineTo(e-i,n+i),t.lineTo(e-i,n-i)})(t,e,n),i?t.fill():(t.globalCompositeOperation="destination-out",t.fill(),t.globalCompositeOperation="source-over",t.stroke())},ce=(t,e,n,o,i={})=>{const s=re({fill:!1},i).fill;t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.stroke(),t.beginPath(),((t,{x:e,y:n},o)=>{const i=o/2;t.ellipse(e,n,i,i,0,0,2*Math.PI)})(t,n,o),s?t.fill():(t.globalCompositeOperation="destination-out",t.fill(),t.globalCompositeOperation="source-over",t.stroke())},he=(t,e,n,o,i={})=>{const s=re({fillOrigin:!1,fillLeadingControl:!1,fillFollowingControl:!1},i),r=s.fillOrigin,a=s.fillLeadingControl,l=s.fillFollowingControl,c=e.originPoint.getAtBasePoint(n);e.leadingControlPointGlobal&&ce(t,c,e.leadingControlPointGlobal.getAtBasePoint(n),o,{fill:a}),e.followingControlPointGlobal&&ce(t,c,e.followingControlPointGlobal.getAtBasePoint(n),o,{fill:l}),le(t,c,o,{fill:r})},de=(t,e,n)=>{const o=new Path2D,i=(t,n)=>{const i=n.originPoint.getAtBasePoint(e),s=i.x,r=i.y,a=t.leadingControlPointGlobal,l=n.followingControlPointGlobal;if(a&&l){const t=a.getAtBasePoint(e),n=t.x,i=t.y,c=l.getAtBasePoint(e),h=c.x,d=c.y;o.bezierCurveTo(n,i,h,d,s,r)}else if(a){const t=a.getAtBasePoint(e),n=t.x,i=t.y;o.quadraticCurveTo(n,i,s,r)}else if(l){const t=l.getAtBasePoint(e),n=t.x,i=t.y;o.quadraticCurveTo(n,i,s,r)}else o.lineTo(s,r)};return t.forEach((n,s)=>{if(0===s){const t=n.originPoint.getAtBasePoint(e),i=t.x,s=t.y;o.moveTo(i,s)}else i(t[s-1],n)}),n&&(i(t[t.length-1],t[0]),o.closePath()),o},pe=5,ue=150;var ge=G(I(class extends o.Component{constructor(...t){var e;return e=super(...t),this._unsubscribes=[],this._drag=null,this.handlePointerDown=(()=>{const t=this.props.viewport.pointer.scenePosition;l()(t,"viewport must have position to be pressed"),this._drag={startTime:Date.now(),startScenePosition:t.clone(),hasNotifiedStart:!1,asyncDrag:this.startAsyncDrag()},this.props.onPointerDown&&this.props.onPointerDown(this.props.viewport)}),this.handlePointerMove=(()=>{const t=this.props.viewport,e=t.pointer.screenPosition;l()(e,"viewport must have position for pointermove");const n=this._drag;if(n){if(!n.hasNotifiedStart){const o=t.sceneCoordsToScreenCoords(n.startScenePosition.x,n.startScenePosition.y);(n.startTime+ue>Date.now()||e.distanceTo(o)>pe)&&(this.props.onDragStart&&this.props.onDragStart(t),n.hasNotifiedStart=!0,n.asyncDrag&&n.asyncDrag.notifyStart())}n.hasNotifiedStart&&(this.props.onDragMove&&this.props.onDragMove(this.props.viewport),n.asyncDrag&&n.asyncDrag.notifyMove())}this.props.onPointerMove&&this.props.onPointerMove(this.props.viewport)}),this.handlePointerUp=(()=>{const t=this._drag;l()(t,"drag must be defined"),t.hasNotifiedStart?this.props.onDragEnd&&this.props.onDragEnd(this.props.viewport):this.props.onClick&&this.props.onClick(this.props.viewport),this.props.onPointerUp&&this.props.onPointerUp(this.props.viewport),t.asyncDrag&&t.asyncDrag.notifyEnd()}),e}componentDidMount(){const t=this.props.viewport.pointer;this._unsubscribes.push(t.onPointerDown(this.handlePointerDown)),this._unsubscribes.push(t.onPointerMove(this.handlePointerMove)),this._unsubscribes.push(t.onPointerUp(this.handlePointerUp))}componentWillUnmount(){this._unsubscribes.forEach(t=>t()),this._unsubscribes=[]}startAsyncDrag(){const t=this.props,e=t.viewport,n=t.onDragAsync;if(!n)return null;let o=t=>{},i=t=>{};return n(e,new Promise(t=>{o=t}),()=>new Promise(t=>{i=t})),{notifyStart:()=>{o(!1)},notifyMove:()=>{i(!0)},notifyEnd:()=>{o(!0),i(!1)}}}render(){return null}}));var me=class extends i.a.Component{constructor(...t){var e;return e=super(...t),this.drawHover=((t,e)=>{const n=this.getHoveredItem(e);n&&this.drawSelectionItem(t,n,Yt.a.A400,e)}),this.drawSelection=((t,e)=>{e.editor.selection.forEach(n=>{this.drawSelectionItem(t,n,Jt.a.A400,e)})}),this.handleClick=(t=>{t.pointer;const e=t.keyboard,n=t.editor,o=this.getHoveredItem(t);o?e.isPressed("shift")||e.isPressed("ctrl")?n.toggleSelected(o):n.replaceSelection([o]):n.clearSelection()}),this.handleDragAsync=(async(t,e,n)=>{const o=this.getHoveredItem(t);if(o)switch(o.type){case"MagicPointThingySelectionItem":return await this.handleMagicPointThingyDrag(o,t,e,n);case"ShapeSelectionItem":return await this.handleShapeDrag(o,t,e,n);case"ControlPointSelectionItem":return await this.handleControlPointDrag(o,t,e,n);default:throw new Error(`Unknown selection type: ${o.type}`)}}),e}getHoveredItem({pointer:t,editor:e,nearestKeyPoint:n,px:o}){const i=t.scenePosition;if(!i)return null;const s=8*o;for(const r of e.selection)if("MagicPointThingySelectionItem"===r.type){const t=r.point.leadingControlPointGlobal;if(t&&t.getAtKeyPoint(n).distanceTo(i)<s)return{type:"ControlPointSelectionItem",point:r.point,inShape:r.inShape,controlPoint:"leading"};const e=r.point.followingControlPointGlobal;if(e&&e.getAtKeyPoint(n).distanceTo(i)<s)return{type:"ControlPointSelectionItem",point:r.point,inShape:r.inShape,controlPoint:"following"}}return t.hoveredItem}drawSelectionItem(t,e,n,o){switch(e.type){case"ShapeSelectionItem":return this.drawShapeSelectionGuide(t,e.shape,n,o);case"MagicPointThingySelectionItem":return this.drawPointSelectionGuide(t,e.inShape,e.point,n,o,{fillOrigin:!0,fillLeadingControl:!1,fillFollowingControl:!1});case"ControlPointSelectionItem":return this.drawPointSelectionGuide(t,e.inShape,e.point,n,o,{fillOrigin:!1,fillLeadingControl:"leading"===e.controlPoint,fillFollowingControl:"following"===e.controlPoint});default:throw new Error(`Unknown selection item type: ${e.type}`)}}drawShapeSelectionGuide(t,e,n,o){this.drawShapeOutline(t,e,n,o),this.drawPointOutlines(t,e,n,o)}drawPointSelectionGuide(t,e,n,o,i,s){this.drawShapeSelectionGuide(t,e,o,i),t.beginPath(),t.strokeStyle=o,t.fillStyle=o;const r=i.px,a=i.basePoint;he(t,n,a,5*r,s)}drawShapeOutline(t,e,n,{px:o,basePoint:i}){t.lineWidth=o,t.strokeStyle=n,t.stroke(e.getCanvasPathAtBasePoint(i))}drawPointOutlines(t,e,n,{px:o,basePoint:i}){t.lineWidth=o,t.strokeStyle=n,e.points.forEach(e=>{le(t,e.originPoint.getAtBasePoint(i),5*o)})}async handleMagicPointThingyDrag(t,e,n,o){if(!await n)for(;await o();){const n=e.pointer.scenePosition;n&&t.point.originPoint.setAtKeyPoint(e.nearestKeyPoint,n)}}async handleShapeDrag(t,e,n,o){let i=e.pointer.scenePosition;if(l()(i,"viewport pointer must be active"),!await n)for(;await o();){const n=e.pointer.scenePosition;l()(n,"viewport pointer must be active");const o=n.subtract(i);t.shape.points.forEach(t=>{t.originPoint.setAtKeyPoint(e.nearestKeyPoint,t.originPoint.getAtKeyPoint(e.nearestKeyPoint).add(o))}),i=n}}async handleControlPointDrag(t,e,n,o){if(!await n)for(;await o();){const n=e.pointer.scenePosition;if(n)if("leading"===t.controlPoint){const o=t.point.leadingControlPointGlobal;l()(o,"leading control point must exist"),o.setAtKeyPoint(e.nearestKeyPoint,n),t.point.leadingControlPointGlobal=o}else{const o=t.point.followingControlPointGlobal;l()(o,"following control point must exist"),o.setAtKeyPoint(e.nearestKeyPoint,n),t.point.followingControlPointGlobal=o}}}render(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(zt,{draw:this.drawHover}),i.a.createElement(zt,{draw:this.drawSelection}),i.a.createElement(ge,{onClick:this.handleClick,onDragAsync:this.handleDragAsync}))}};const we="#000000",Pe="#abcdef";class ve{constructor(){this.id=Object(Qt.b)(),this.hasStroke=!0,this.hasFill=!1,this.strokeWidth=1,this.strokeColor=we,this.fillColor=Pe}drawCurrentContextPath(t){this.hasFill&&(t.fillStyle=this.fillColor,t.fill()),this.hasStroke&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke())}drawPath(t,e){this.hasFill&&(t.fillStyle=this.fillColor,t.fill(e)),this.hasStroke&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke(e))}}Object(Qt.f)(ve,"ShapeStyle",["hasFill","hasStroke","strokeWidth","strokeColor","fillColor"]);var ye=Object(y.i)(ve,{strokeWidth:y.n,strokeColor:y.n,fillColor:y.n,hasStroke:y.n,hasFill:y.n});class fe{constructor(){this.id=Object(Qt.b)(),this.style=new ye,this.points=[],this.isClosed=!1}addPoint(t){this.points.push(t)}close(){this.isClosed=!0}getCanvasPathAtBasePoint(t){return de(this.points,t,this.isClosed)}drawToCanvasAtBasePoint(t,e){this.style.drawPath(t,this.getCanvasPathAtBasePoint(e))}}Object(Qt.f)(fe,"Shape",["isClosed"],{style:Object(Qt.c)(ye),points:Object(Qt.d)(oe)});var be=Object(y.i)(fe,{style:y.n,points:y.n,isClosed:y.n});var Ce=I(Object(d.a)(Object(y.i)(class extends i.a.Component{constructor(...t){var e;return e=super(...t),this.targetShape=null,this.isDragging=!1,this.draw=((t,{basePoint:e,px:n})=>{const o=this.getTargetScenePoints(),i=o.shapePoints,s=o.isClosed;t.lineWidth=n,t.strokeStyle=Jt.a.A400,t.stroke(de(i,e,s)),i.forEach(o=>{he(t,o,e,5*n)})}),this.handleDrag=(async({pointer:t,editor:e,nearestKeyPoint:n},o,i)=>{const s=t.scenePosition;l()(s,"pointer must be active");const r=this.getOrCreateTargetShape(),a=this.shouldSnapClosed();let c;if(a)c=r.points[0],r.close();else{const t=e.scene.createMagicPointThingy();t.setAtKeyPoint(n,s),c=(new se).init(t),r.addPoint(c)}if(!await o){for(this.isDragging=!0;await i();){const o=c.leadingControlPointGlobal||e.scene.createMagicPointThingy();l()(t.scenePosition,"scenePosition must be set"),o.setAtKeyPoint(n,t.scenePosition),c.leadingControlPointGlobal=o}this.isDragging=!1}a&&(this.targetShape=null)}),e}shouldSnapClosed(){const t=this.props.viewport,e=t.nearestKeyPoint,n=t.pointer,o=t.sceneCoordsToScreenCoords,i=n.screenPosition;if(!i)return!1;const s=this.targetShape&&this.targetShape.points;if(!s||s.length<2)return!1;const r=s[0].originPoint.getAtKeyPoint(e);return o(r.x,r.y).distanceTo(i)<7}getTargetScenePoints(){const t=this.props.viewport,e=t.pointer,n=t.editor,o=t.nearestKeyPoint,i=this.targetShape,s=this.isDragging,r=e.scenePosition,a=i?i.points:[];if(r){if(s)return{shapePoints:a,isClosed:!!i&&i.isClosed,isLastPointGuide:!1};if(this.shouldSnapClosed())return{shapePoints:a,isClosed:!0,isLastPointGuide:!1};const t=n.scene.createMagicPointThingy();return t.setAtKeyPoint(o,r),{shapePoints:[...a,(new se).init(t)],isClosed:!1,isLastPointGuide:!0}}return{shapePoints:a,isClosed:!1,isLastPointGuide:!1}}getOrCreateTargetShape(){if(this.targetShape)return this.targetShape;const t=new be;return this.props.viewport.editor.scene.addShape(t),this.targetShape=t,t}render(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(zt,{draw:this.draw}),i.a.createElement(ge,{onDragAsync:this.handleDrag}))}},{targetShape:y.n,isDragging:y.n})));var Se=G(I(Object(d.a)(class extends i.a.Component{render(){const t=this.props.viewport.editor.tool;switch(t){case"SELECT":return i.a.createElement(me,null);case"PEN":return i.a.createElement(Ce,null);default:throw new Error(`unknown tool: ${t}`)}}})));var Ee=Object(d.a)(class extends i.a.Component{constructor(...t){var e;return e=super(...t),this.draw=((t,{basePoint:e})=>{this.props.shape.drawToCanvasAtBasePoint(t,e)}),e}render(){return i.a.createElement(zt,{draw:this.draw})}});var ke=G(I(Object(d.a)(class extends i.a.Component{render(){const t=this.props.viewport.editor.scene;return i.a.createElement(i.a.Fragment,null,t.shapes.map((t,e)=>i.a.createElement(Ee,{shape:t,key:e})))}})));var xe=G(I(class extends i.a.Component{constructor(...t){var e;return e=super(...t),this._unsubscribes=[],this.handlePointerMove=(({keyboard:t,pointer:e,basePoint:n})=>{t.isPressed("ctrl")&&e.scenePosition&&n.set(e.scenePosition)}),this.handleCtrlDown=(()=>{const t=this.props.viewport,e=t.pointer,n=t.basePoint;e.scenePosition&&n.set(e.scenePosition)}),this.handleCtrlUp=(()=>{const t=this.props.viewport,e=t.basePoint,n=t.nearestKeyPoint;e.set(n)}),e}render(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(ge,{onPointerMove:this.handlePointerMove}),i.a.createElement(Kt,{name:"ctrl",onDown:this.handleCtrlDown,onUp:this.handleCtrlUp}))}}));var Oe=Object(d.a)(class extends i.a.Component{render(){const t=this.props.editor;return i.a.createElement(i.a.Fragment,null,i.a.createElement(N,null),i.a.createElement(It,{editor:t}),i.a.createElement(Ct,{editor:t}),i.a.createElement(A,{editor:t,style:{position:"absolute",top:64,left:48,right:300,bottom:0}},i.a.createElement(ke,null),i.a.createElement(Wt,null),i.a.createElement(xe,null),i.a.createElement(Vt,null),i.a.createElement(Se,null)))}});class De{constructor(){this.id=Object(Qt.b)(),this.width=void 0,this.height=void 0,this.keyPointSet=void 0,this.shapes=[]}static deserialize(t){const e=Object(Qt.a)(t);return l()(e instanceof De,"deserialized object is not Scene"),e}init(t,e){return this.width=t,this.height=e,this.keyPointSet=new te,this.keyPointSet.addKeyPoint(new f.a(.25*t,.25*e)),this.keyPointSet.addKeyPoint(new f.a(.75*t,.25*e)),this.keyPointSet.addKeyPoint(new f.a(.75*t,.75*e)),this.keyPointSet.addKeyPoint(new f.a(.25*t,.75*e)),this}addShape(t){this.shapes.push(t)}serialize(){return Object(Qt.g)(this)}createMagicPointThingy(){return(new oe).init(this.keyPointSet)}}Object(Qt.f)(De,"Scene",["width","height"],{keyPointSet:Object(Qt.c)(te),shapes:Object(Qt.d)(be)});var Te=Object(y.i)(De,{width:y.n,height:y.n,shapes:y.n});window.Scene=De;var je=n(214),Me=n.n(je);const Ke="drag-animate.autosave";class Ae{static fromAutoSave(t){try{const e=localStorage.getItem(Ke);l()(null!=e,"no autosave present");const n=JSON.parse(e),o=Te.deserialize(n);return new Ae(o)}catch(e){return console.warn(`Could not resore from autosave: ${e.message}`),new Ae(t())}}constructor(t){this.tool=Ot.SELECT,this.scene=void 0,this.selection=[],this.commands={replaceDocumentWithNew:(t=200,e=100)=>{this.scene=(new Te).init(t,e)}},this.scene=t,Object.keys(this.commands).forEach(t=>{this.commands[t]=Object(y.d)(`Editor.commands.${t}`,this.commands[t])})}startAutosaving(){return Object(y.e)(()=>{try{const t=this.scene.serialize(),e=JSON.stringify(t);localStorage.setItem(Ke,e),console.log("Saved.")}catch(t){console.warn(`couldnt autosave: ${t.message}`)}},{delay:2500})}setTool(t){this.tool=t}replaceSelection(t){this.selection=t}toggleSelected(t){const e=this.selection.findIndex(e=>Me()(e,t));null!=e?this.selection.splice(e,1):this.selection.push(t)}clearSelection(){this.replaceSelection([])}}var Ie=Object(y.i)(Ae,{scene:y.n,tool:y.n,selection:y.n,setTool:y.d,replaceSelection:y.d,clearSelection:y.d,toggleSelected:y.d});k.setup();const _e=document.getElementById("root");l()(_e,"root must exist");const Re=Ie.fromAutoSave(()=>(new Te).init(200,100));Re.startAutosaving(),window.editor=Re,r.a.render(i.a.createElement(i.a.Fragment,null,i.a.createElement(h.a,null),i.a.createElement(Oe,{editor:Re})),_e)},557:function(t,e,n){n(556),t.exports=n(225)},9:function(t,e,n){"use strict";var o=n(5),i=n.n(o);let s=0;const r=()=>`${Date.now().toString(36)}.${(s++).toString(36)}`;function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){l(t,e,n[e])})}return t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"c",function(){return v}),n.d(e,"d",function(){return y}),n.d(e,"e",function(){return f}),n.d(e,"f",function(){return C}),n.d(e,"g",function(){return S}),n.d(e,"a",function(){return k}),n.d(e,"b",function(){return r});const c=t=>new Error(`impossible value ${t}`),h=new Map,d=new Map,p=(t,e)=>({ctor:e.ctor||t.ctor,name:e.name||t.name,primitives:[...t.primitives,...e.primitives],refs:a({},t.refs,e.refs)}),u=t=>{const e=h.get(t);return i()(e,`model ${t.__proto__.constructor.name} is not serializable`),e},g=(t,e)=>{const n=(t=t,i()(!String(t.id).includes("#"),`id "${String(t.id)}" must not include "#"`),`${u(t.__proto__.constructor).name}#${String(t.id)}`);return e[n]||(e[n]=P(t,e)),n};var m;const w=(t,e,n)=>{if(null===e)return null;switch(t.type){case"one":return g(e,n);case"list":return((t,e)=>t.map(t=>g(t,e)))(e,n);case"object-map":return((t,e)=>Object.keys(t).map(n=>[n,g(t[n],e)]).reduce((t,[e,n])=>a({},t,{[e]:n}),{}))(e,n);default:throw c(t.type)}},P=(t,e)=>{const n=u(t.__proto__.constructor),o=n.primitives,i=n.refs,s={};return o.forEach(e=>s[e]=t[e]),Object.keys(i).forEach(n=>{s[n]=w(i[n],t[n],e)}),s},v=t=>({type:"one",target:t}),y=t=>({type:"list",target:t}),f=t=>({type:"object-map",target:t}),b=t=>{const e=t.__proto__,n=e?b(e):[],o=h.get(t);return o?[...n,o]:n},C=(t,e,n,o={})=>{i()(!e.includes("#"),`name "${e}" cant include "#"`),i()(!d.has(e),`serializable class with name ${e} already exists`);const s=[...b(t),{ctor:t,name:e,primitives:n,refs:o}].reduce(p);h.set(t,s),d.set(e,s)},S=t=>{const e={};return{rootId:g(t,e),objectsById:e}},E=(t,e,n={})=>{if(!n[e]){const o=t[e];i()(o,`no object found for id ${String(e)}`);const s=(t=>{const e=t.split("#");i()(2===e.length,`invalid id "${t}"`);const n=d.get(e[0]);return i()(n,`unknown serialize model ${e[0]}`),{model:n,id:e[1]}})(e),r=s.model,l=s.id,h=r.primitives,p=r.refs,u=new(0,r.ctor);u.id=l,h.forEach(t=>u[t]=o[t]),Object.keys(p).forEach(e=>{u[e]=((t,e,n,o={})=>{if(null===e)return null;switch(t.type){case"one":return E(n,e,o);case"list":return e.map(t=>E(n,t,o));case"object-map":return Object.keys(e).map(t=>[t,E(n,e[t],o)]).reduce((t,[e,n])=>a({},t,{[e]:n}),{});default:throw c(t.type)}})(p[e],o[e],t,n)}),n[e]=u}return n[e]},k=t=>{const e=t.rootId,n=t.objectsById;return E(n,e)}}},[[557,0,1]]]);
//# sourceMappingURL=main.80c8d9c0.chunk.js.map