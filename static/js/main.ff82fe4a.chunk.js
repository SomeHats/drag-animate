(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{138:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return r});var o=n(5),i=n.n(o);n(19);n(232);var s=function(){var t,n,o,s=function(e,t){var n=function(e,t){var n=0;if(!e.length)return Math.sqrt(Math.pow(e-t,2));for(var o=0;o<e.length;o++)n+=Math.pow(e[o]-t[o],2);return Math.sqrt(n)}(e,t);return 0===n?0:Math.pow(n,2)*Math.log(n)};this.compile=function(r,a){i()(r&&r.length,"bad centers array :/"),t=r.map(function(e){return e}),o=a.map(function(e){return e});for(var l=[],c=[],h=[],d=[],p=0;p<t.length;p++){c=[],d=[1];for(var u=0;u<t[p].length;u++)d.push(t[p][u]);for(var g=0;g<t.length;g++)c.push(s(t[p],t[g]));h.push(d),l.push(c.concat(d))}var m=e.$M(h).transpose().elements.map(function(e){for(var t=e.length;t<l[0].length;t++)e.push(0);return e});for(p=0;p<m.length;p++)l.push(m[p]),o.push(0);n=this._solve(o,l),i()(n,"rbf failed to compile with given centers./nCenters must be unique :/")},this._solve=function(t,n){var o=e.$M(n),i=e.$V(t);if(o=o.inverse())return o.multiply(i)},this.getValue=function(e){var o=0,i=0;for(i=0;i<t.length;i++)o+=Number(n.elements[i])*s(e,t[i]);for(o+=Number(n.elements[t.length]),i=0;i<e.length;i++)o+=e[i]*Number(n.elements[t.length+(i+1)]);return o},this.getValues=function(e,t){setTimeout(function(){var n=e.map(function(e){return this.getValue(e)},this);t(null,{points:e,ys:n})}.bind(this),0)}};class r{constructor(e,t){this.tps=new s,this.tps.compile(e.map(({x:e,y:t})=>[e,t]),t)}getValue(e){return this.tps.getValue([e.x,e.y])}}}).call(this,n(26))},19:function(e,t,n){"use strict";var o=n(1),i=n(9);class s{constructor(e,t){this.id=Object(i.b)(),this.x=void 0,this.y=void 0,this.x=e,this.y=t}clone(){return new s(this.x,this.y)}distanceTo(e){const t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}setXY(e,t){this.x=e,this.y=t}set(e){this.x=e.x,this.y=e.y}findNearest(e){let t=null,n=1/0;return e.forEach(e=>{const o=this.distanceTo(e);o<n&&(t=e,n=o)}),t}add(e){return new s(this.x+e.x,this.y+e.y)}subtract(e){return new s(this.x-e.x,this.y-e.y)}scale(e){return new s(this.x*e,this.y*e)}}Object(i.f)(s,"Vector2",["x","y"]),Object(o.i)(s,{x:o.n,y:o.n}),t.a=s},228:function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o),s=n(18),r=n.n(s),a=n(5),l=n.n(a),c=n(561),h=n.n(c),d=n(10),p=n(224),u=n.n(p);const g=()=>document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,m={position:"fixed",top:"0px",left:"0px",width:"100%",height:"100%",zIndex:"10000",touchAction:"none"};var w=n(48),P=n.n(w),v=n(1),y=n(19);var f=Object(v.i)(class extends P.a{constructor(e){super(),this.viewport=void 0,this.screenPosition=null,this.isDown=!1,this.cursor="default",this.viewport=e}get isActive(){return null!==this.screenPosition}get scenePosition(){const e=this.screenPosition;return e?this.viewport.screenCoordsToSceneCoords(e.x,e.y):null}setPosition(e,t){this.screenPosition?this.screenPosition.setXY(e,t):this.screenPosition=new y.a(e,t)}clearPosition(){this.screenPosition=null}triggerPointerDown(){this.isDown=!0,this.emit("pointerDown")}triggerPointerMove(){this.emit("pointerMove")}triggerPointerUp(){this.isDown=!1,this.emit("pointerUp")}onPointerDown(e){const t=()=>e(this.viewport);return this.addListener("pointerDown",t),()=>{this.removeListener("pointerDown",t)}}onPointerMove(e){const t=()=>e(this.viewport);return this.addListener("pointerMove",t),()=>{this.removeListener("pointerMove",t)}}onPointerUp(e){const t=()=>e(this.viewport);return this.addListener("pointerUp",t),()=>{this.removeListener("pointerUp",t)}}get hoveredItem(){return this.scenePosition?this.viewport.getItemAtSceneCoord(this.scenePosition):null}},{isDown:v.n,screenPosition:v.n,cursor:v.n,scenePosition:v.f,isActive:v.f,hoveredItem:v.f,setPosition:v.d,triggerPointerDown:v.d,triggerPointerMove:v.d,triggerPointerUp:v.d}),b=n(39),C=n.n(b);class S{constructor(){this._events=new P.a,this._isPressedByKeyCode={},this.handleKeyDown=(e=>{this._isPressedByKeyCode[e.keyCode]=!0,this._events.emit(`keyDown:${e.keyCode}`)}),this.handleKeyUp=(e=>{this._isPressedByKeyCode[e.keyCode]=!1,this._events.emit(`keyUp:${e.keyCode}`)})}setup(){window.addEventListener("keydown",this.handleKeyDown,!1),window.addEventListener("keyup",this.handleKeyUp,!1)}teardown(){window.removeEventListener("keydown",this.handleKeyDown,!1),window.removeEventListener("keyup",this.handleKeyUp,!1)}keyCodeOrNameToKeyCode(e){return"number"===typeof e?e:C()(e)}isPressed(e){const t=this.keyCodeOrNameToKeyCode(e);return!!this._isPressedByKeyCode[t]}onKeyDown(e,t){const n=this.keyCodeOrNameToKeyCode(e),o=()=>t();return this._events.addListener(`keyDown:${n}`,o),()=>{this._events.removeListener(`keyDown:${n}`,o)}}onKeyUp(e,t){const n=this.keyCodeOrNameToKeyCode(e),o=()=>t();return this._events.addListener(`keyUp:${n}`,o),()=>{this._events.removeListener(`keyUp:${n}`,o)}}}Object(v.i)(S,{_isPressedByKeyCode:v.n,handleKeyDown:v.d,handleKeyUp:v.d});var E=new S;const k=15,O=document.createElement("canvas").getContext("2d");var x=Object(v.i)(class extends P.a{constructor(e){super(),this.keyboard=E,this.top=0,this.left=0,this.bottom=0,this.right=0,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.scale=window.devicePixelRatio||1,this.editor=void 0,this.basePoint=new y.a(0,0),this.pointer=new f(this),this.sceneCoordsToScreenCoords=((e,t)=>new y.a(e*this.zoom+this.panX+this.left,t*this.zoom+this.panY+this.top)),this.screenCoordsToSceneCoords=((e,t)=>new y.a((e-this.left-this.panX)/this.zoom,(t-this.top-this.panY)/this.zoom)),this.editor=e,this.basePoint.set(e.scene.keyPointSet.keyPoints[0])}get sceneWidth(){return this.editor.scene.width}get sceneHeight(){return this.editor.scene.height}get pxWidth(){return this.windowWidth-this.left-this.right}get pxHeight(){return this.windowHeight-this.top-this.bottom}get zoom(){const e=this.pxWidth-2*k,t=this.pxHeight-2*k;return Math.min(e/this.sceneWidth,t/this.sceneHeight)}get panX(){const e=this.pxWidth-2*k;return this.zoom*this.sceneWidth<e?k+(e/2-this.zoom*this.sceneWidth/2):k}get panY(){const e=this.pxHeight-2*k;return this.zoom*this.sceneHeight<e?k+(e/2-this.zoom*this.sceneHeight/2):k}get px(){return 1/this.zoom}get nearestKeyPoint(){const e=this.basePoint.findNearest(this.editor.scene.keyPointSet.keyPoints);return l()(e,"nearest must be found"),e}get scene(){return this.editor.scene}setSize(e,t,n,o,i,s,r){this.windowWidth=e,this.windowHeight=t,this.scale=n,this.left=o,this.top=i,this.right=s,this.bottom=r}getItemAtSceneCoord(e){const t=8*this.px;O.lineWidth=t;for(const n of this.editor.scene.shapes){for(const i of n.points)if(e.distanceTo(i.originPoint.getAtBasePoint(this.basePoint))<t)return{type:"MagicPointThingySelectionItem",point:i,inShape:n};const o=n.getCanvasPathAtBasePoint(this.basePoint);if(O.isPointInStroke(o,e.x,e.y))return{type:"ShapeSelectionItem",shape:n}}return null}},{windowWidth:v.n,windowHeight:v.n,scale:v.n,top:v.n,left:v.n,bottom:v.n,right:v.n,editor:v.n,pointer:v.n,sceneWidth:v.f,sceneHeight:v.f,pxWidth:v.f,pxHeight:v.f,zoom:v.f,panX:v.f,panY:v.f,px:v.f,scene:v.f,nearestKeyPoint:l.a,setSize:v.d});function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const D=o.createContext(null),j=D.Provider,K=D.Consumer,M=({children:e})=>o.createElement(K,null,t=>(l()(t,"Viewport must exist"),e(t))),A=Object(d.a)(class extends o.Component{constructor(...e){var t;return t=super(...e),this.state={viewport:null},this.sizer=null,this.pointableCover=void 0,this.isPointerDown=!1,this.handleResize=(()=>{this.setViewportSize(this.state.viewport)}),this.sizerRef=(e=>{this.sizer=e}),this.handleMouseDown=(()=>{const e=this.state.viewport;l()(e,"viewport must exist"),this.isPointerDown=!0,this.pointableCover.attach(),e.pointer.triggerPointerDown()}),this.handleMouseMove=(e=>{const t=this.state.viewport;l()(t,"viewport must exist"),t.pointer.setPosition(e.clientX,e.clientY),t.pointer.triggerPointerMove()}),this.handleMouseUp=(()=>{const e=this.state.viewport;l()(e,"viewport must exist"),this.isPointerDown=!1,this.pointableCover.remove(),e.pointer.triggerPointerUp();const t=e.pointer.screenPosition;l()(t,"viewport pointer must be active"),(e.left>t.x||t.x>e.windowWidth-e.right||e.top>t.y||t.y>e.windowHeight-e.bottom)&&e.pointer.clearPosition()}),this.handleMouseLeave=(()=>{const e=this.state.viewport;l()(e,"viewport must exist"),this.isPointerDown||e.pointer.clearPosition()}),t}componentDidMount(){this.pointableCover=new class{constructor({down:e,move:t,up:n}={}){this.onDown=null,this.onMove=null,this.onUp=null,this.attachedTo=null,this.cover=void 0,this.onDown=e,this.onMove=t,this.onUp=n;const o=document.createElement("div");Object.assign(o.style,m),o.setAttribute("touch-action","none"),this.cover=o}attach(){if(!this.attachedTo){const e=g()||document.body;l()(null!=e,"target must exist"),e.appendChild(this.cover),this.attachedTo=e,this.attachEvents()}}remove(){const e=this.attachedTo;e&&(this.attachedTo=null,this.removeEvents(),e.removeChild(this.cover))}attachEvents(){this.onDown&&this.cover.addEventListener("pointerdown",this.onDown,!1),this.onMove&&this.cover.addEventListener("pointermove",this.onMove,!1),this.onUp&&this.cover.addEventListener("pointerup",this.onUp,!1)}removeEvents(){this.onDown&&this.cover.removeEventListener("pointerdown",this.onDown),this.onMove&&this.cover.removeEventListener("pointermove",this.onMove),this.onUp&&this.cover.removeEventListener("pointerup",this.onUp)}}({down:this.handleMouseDown,move:this.handleMouseMove,up:this.handleMouseUp});const e=new x(this.props.editor);this.setState({viewport:e}),this.setViewportSize(e),window.addEventListener("resize",this.handleResize)}componentDidUpdate(){this.setViewportSize(this.state.viewport)}componentWillUnmount(){this.pointableCover.remove(),window.removeEventListener("resize",this.handleResize)}setViewportSize(e){const t=this.sizer;l()(t,"container must be set"),l()(e,"viewport must be set");const n=window.innerWidth,o=window.innerHeight,i=window.devicePixelRatio||1,s=t.getBoundingClientRect(),r=s.left,a=s.top,c=s.right,h=s.bottom;e.setSize(n,o,i,r,a,n-c,o-h)}renderViewport(e){const t=this.props,n=t.children,i=t.editor;return l()(e.editor===i,"prop editor must not change"),o.createElement(j,{value:e},n)}render(){const e=this.props,t=e.style,n=e.children,i=e.editor,s=this.state.viewport;s&&l()(s.editor===i,"prop editor must not change");const r=s?s.pointer.cursor:"default";return o.createElement(o.Fragment,null,s&&o.createElement(j,{value:s},n),o.createElement("div",{ref:this.sizerRef,style:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){T(e,t,n[t])})}return e}({},t,{cursor:r}),onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseLeave}))}}),I=e=>{var t,n;return n=t=class extends o.Component{render(){return o.createElement(M,null,t=>o.createElement(e,Object.assign({},this.props,{viewport:t})))}},t.displayName=`withViewport(${u()(e)})`,n};var _=n(32),B=n(577),R=n.n(B),U=n(576),z=n.n(U),N=n(222),W=n.n(N);var L=Object(_.withStyles)(e=>({appBar:{zIndex:e.zIndex.drawer+1}}))(({classes:e})=>i.a.createElement(R.a,{position:"absolute",className:e.appBar},i.a.createElement(z.a,null,i.a.createElement(W.a,{variant:"title",color:"inherit"},"Drag Animate")))),$=n(225),F=n.n($);var G=e=>e,H=n(65),Y=n.n(H),V=n(139),X=n.n(V),q=n(573),J=n.n(q),Q=n(572),Z=n.n(Q),ee=n(226),te=n.n(ee),ne=n(66),oe=n.n(ne),ie=n(40),se=n.n(ie),re=n(141),ae=n.n(re),le=n(49),ce=n.n(le),he=n(574),de=n.n(he),pe=n(227),ue=n.n(pe),ge=n(571),me=n.n(ge),we=n(7),Pe=n.n(we),ve=n(575),ye=n.n(ve),fe=n(220),be=n.n(fe),Ce=n(221),Se=n.n(Ce);const Ee=({rgb:e})=>"number"===typeof e.a?`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`:`rgb(${e.r}, ${e.g}, ${e.b})`;var ke=Object(_.withStyles)(e=>({container:{position:"relative"},popper:{zIndex:e.zIndex.tooltip,marginTop:e.spacing.unit},button:{boxShadow:e.shadows[1],"&:active":{boxShadow:e.shadows[3]}}}))(class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.state={anchor:null,isOpen:!1},this.onChange=(e=>{this.props.onChange(Ee(e))}),this.onClickButton=(()=>{this.setState(({isOpen:e})=>({isOpen:!e}))}),this.onClose=(()=>{this.setState({isOpen:!1})}),this.buttonRef=(e=>{this.setState({anchor:e||null})}),t}render(){const e=this.props,t=e.value,n=e.classes,o=e.className,s=this.state,r=s.isOpen,a=s.anchor;return i.a.createElement("div",{className:Pe()(n.container,o)},i.a.createElement(ye.a,{buttonRef:this.buttonRef,className:n.button,style:{background:t},onClick:this.onClickButton,variant:"fab",mini:!0}," "),a&&i.a.createElement(be.a,{className:n.popper,open:r,anchorEl:a,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},onClose:this.onClose},i.a.createElement(Se.a,{color:t,onChangeComplete:this.onChange})))}});var Oe=G(Object(_.withStyles)(e=>({gutters:{paddingRight:2*e.spacing.unit},nested:{paddingLeft:2*e.spacing.unit},input:{width:8*e.spacing.unit},item:{height:7*e.spacing.unit}}))(Object(d.a)(Object(v.i)(class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.onToggleStroke=Y()(()=>{const e=this.props.shape.style;e.hasStroke=!e.hasStroke},0),this.onToggleFill=Y()(()=>{const e=this.props.shape.style;e.hasFill=!e.hasFill},0),this.onChangeStrokeWidth=(e=>{l()(e.currentTarget instanceof HTMLInputElement,"target must be input");const t=parseFloat(e.currentTarget.value);isNaN(t)||(this.props.shape.style.strokeWidth=t)}),this.onChangeStrokeColor=(e=>{this.props.shape.style.strokeColor=e}),this.onChangeFillColor=(e=>{this.props.shape.style.fillColor=e}),this.onBringForward=(()=>{const e=this.props,t=e.shape,n=e.editor.scene.shapes,o=n.indexOf(t);if(-1!==o&&o<n.length){const e=n[o+1];n[o]=e,n[o+1]=t}}),this.onSendBackward=(()=>{const e=this.props,t=e.shape,n=e.editor.scene.shapes,o=n.indexOf(t);if(o>0){const e=n[o-1];n[o]=e,n[o-1]=t}}),t}render(){const e=this.props,t=e.shape,n=e.classes,o=e.editor,s=t.style,r=s.hasStroke,a=s.hasFill,l=s.strokeWidth,c=o.scene.shapes,h=c.indexOf(t),d=0===h,p=h===c.length-1;return i.a.createElement(oe.a,{subheader:i.a.createElement(de.a,null,"Shape Properties")},i.a.createElement(se.a,{classes:{gutters:n.gutters}},i.a.createElement(ce.a,null,"Arrange"),i.a.createElement(ae.a,null,i.a.createElement(X.a,{"aria-label":"Bring forward",disabled:p,onClick:this.onBringForward},i.a.createElement(J.a,null)),i.a.createElement(X.a,{"aria-label":"Send back",disabled:d,onClick:this.onSendBackward},i.a.createElement(Z.a,null)))),i.a.createElement(se.a,{classes:{gutters:n.gutters},onClick:this.onToggleStroke,button:!0},i.a.createElement(ce.a,null,"Outline"),i.a.createElement(ae.a,null,i.a.createElement(ue.a,{checked:r,onChange:this.onToggleStroke}))),i.a.createElement(te.a,{in:r,timeout:"auto",unmountOnExit:!0},i.a.createElement(oe.a,{component:"div",disablePadding:!0,className:n.nested},i.a.createElement(se.a,null,i.a.createElement(ce.a,null,"Width"),i.a.createElement(me.a,{className:n.input,type:"number",value:l,onChange:this.onChangeStrokeWidth,inputProps:{step:.1}})),i.a.createElement(se.a,{className:n.item},i.a.createElement(ce.a,null,"Colour"),i.a.createElement(ke,{value:t.style.strokeColor,onChange:this.onChangeStrokeColor})))),i.a.createElement(se.a,{classes:{gutters:n.gutters},onClick:this.onToggleFill,button:!0},i.a.createElement(ce.a,null,"Fill"),i.a.createElement(ae.a,null,i.a.createElement(ue.a,{checked:a,onChange:this.onToggleFill}))),i.a.createElement(te.a,{in:a,timeout:"auto",unmountOnExit:!0},i.a.createElement(oe.a,{component:"div",disablePadding:!0,className:n.nested},i.a.createElement(se.a,{className:n.item},i.a.createElement(ce.a,null,"Colour"),i.a.createElement(ke,{value:t.style.fillColor,onChange:this.onChangeFillColor})))))}},{onToggleFill:v.d,onToggleOutline:v.d,onChangeStrokeWidth:v.d,onChangeStrokeColor:v.d,onChangeFillColor:v.d}))));const xe=e=>{const t=e.selection;if(!t||t.length<1)return null;const n=t[0];switch(n.type){case"ShapeSelectionItem":return n.shape;case"MagicPointThingySelectionItem":case"ControlPointSelectionItem":return n.inShape;default:throw new Error(`Unknown selection type ${n.type}`)}};var Te=G(Object(_.withStyles)(e=>({drawerPaper:{width:300},addButton:{position:"absolute",bottom:2*e.spacing.unit,right:2*e.spacing.unit},toolbar:e.mixins.toolbar}))(Object(d.a)(class extends i.a.Component{render(){const e=this.props,t=e.classes,n=e.editor,o=xe(n);return i.a.createElement(F.a,{variant:"permanent",anchor:"right",classes:{paper:t.drawerPaper}},i.a.createElement("div",{className:t.toolbar}),o&&i.a.createElement(Oe,{shape:o,editor:n}))}}))),De=n(568),je=n.n(De),Ke=n(567),Me=n.n(Ke),Ae=n(566),Ie=n.n(Ae);var _e={SELECT:"SELECT",PEN:"PEN",KEY_POINT:"KEY_POINT"},Be=n(569),Re=n.n(Be),Ue=n(570),ze=n.n(Ue);var Ne=class extends i.a.Component{constructor(...e){var t;return t=super(...e),this._unsubscribes=[],this.handleKeyDown=(()=>{this.props.onDown&&this.props.onDown(E)}),this.handleKeyUp=(()=>{this.props.onUp&&this.props.onUp(E)}),t}componentDidMount(){this.listen()}componentDidUpdate(e){e.name!==this.props.name&&(this.unsubscribe(),this.listen())}listen(){const e=this.props.name;this._unsubscribes.push(E.onKeyDown(e,this.handleKeyDown)),this._unsubscribes.push(E.onKeyUp(e,this.handleKeyUp))}unsubscribe(){this._unsubscribes.forEach(e=>e()),this._unsubscribes=[]}render(){return null}};var We=Object(_.withStyles)(e=>({listItem:{padding:1.5*e.spacing.unit},active:{color:e.palette.primary.light},inactive:{color:e.palette.text.primary},popper:{}}))(Object(d.a)(class extends o.Component{constructor(...e){var t;return t=super(...e),this.handleClick=(()=>{const e=this.props,t=e.editor,n=e.tool;t.setTool(n)}),t}render(){const e=this.props,t=e.name,n=e.shortcutKey,i=e.tool,s=e.editor,r=e.icon,a=e.classes;return o.createElement(o.Fragment,null,o.createElement(Ne,{name:n,onDown:this.handleClick}),o.createElement(ze.a,{title:`${t} (${n.toUpperCase()})`,placement:"right",classes:{popper:a.popper}},o.createElement(se.a,{button:!0,classes:{root:Pe()(a.listItem,{[a.active]:i===s.tool})},onClick:this.handleClick},o.createElement(Re.a,{classes:{root:i===s.tool?a.active:a.inactive}},r))))}}));var Le=G(Object(_.withStyles)(e=>({drawerPaper:{width:48},toolbar:e.mixins.toolbar}))(Object(d.a)(class extends i.a.Component{render(){const e=this.props,t=e.classes,n=e.editor;return i.a.createElement(F.a,{variant:"permanent",anchor:"left",classes:{paper:t.drawerPaper}},i.a.createElement("div",{className:t.toolbar}),i.a.createElement(oe.a,null,i.a.createElement(We,{name:"Select",shortcutKey:"v",tool:_e.SELECT,icon:i.a.createElement(je.a,null),editor:n}),i.a.createElement(We,{name:"Pen",shortcutKey:"p",tool:_e.PEN,icon:i.a.createElement(Me.a,null),editor:n}),i.a.createElement(We,{name:"Key Points",shortcutKey:"k",tool:_e.KEY_POINT,icon:i.a.createElement(Ie.a,null),editor:n})))}}))),$e=n(565),Fe=n.n($e);function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var He=Object(d.a)(class extends o.Component{constructor(...e){var t;return t=super(...e),this.canvas=null,this.ctx=null,this.disposeRenderer=null,this.draw=(()=>{const e=this.ctx;if(!e)return;const t=window.devicePixelRatio,n=this.props,o=n.width,i=n.height,s=n.draw;e.save(),e.scale(t,t),e.clearRect(0,0,o,i),s(e),e.restore()}),this.canvasRef=(e=>{this.canvas=e||null,this.ctx=e?e.getContext("2d"):null,this.props.canvasRef&&this.props.canvasRef(this.canvas),this.props.contextRef&&this.props.contextRef(this.ctx)}),t}componentDidMount(){this.disposeRenderer=Object(v.e)(this.draw,{scheduler:e=>window.requestAnimationFrame(()=>e())})}componentDidUpdate(){this.draw()}componentWillUnmount(){this.disposeRenderer&&this.disposeRenderer()}render(){const e=this.props,t=e.className,n=e.style,i=e.width,s=e.height,r=e.onMouseEnter,a=e.onMouseLeave,l=e.onMouseDown,c=e.onMouseMove,h=e.onMouseUp,d=e.onClick,p=window.devicePixelRatio;return o.createElement("canvas",{ref:this.canvasRef,className:t,style:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){Ge(e,t,n[t])})}return e}({},n,{width:i,height:s}),width:i*p,height:s*p,onMouseEnter:r,onMouseLeave:a,onMouseDown:l,onMouseMove:c,onMouseUp:h,onClick:d})}});var Ye=G(I(Object(d.a)(class extends o.Component{constructor(...e){var t;return t=super(...e),this.draw=(e=>{const t=this.props,n=t.viewport,o=t.draw,i=n.panX,s=n.panY,r=n.zoom;e.translate(i,s),e.scale(r,r),o(e,n)}),t}render(){const e=this.props,t=e.viewport,n=e.canvasRef,i=e.contextRef,s=t.pxWidth,r=t.pxHeight,a=t.left,l=t.top;return o.createElement(He,{style:{position:"absolute",left:a,top:l},draw:this.draw,width:s,height:r,canvasRef:n,contextRef:i})}})));var Ve=class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.draw=((e,t)=>{this.drawOutline(e,t),this.drawBasePoint(e,t)}),t}drawOutline(e,{px:t,sceneWidth:n,sceneHeight:o}){e.strokeStyle="rgba(0, 0, 0, 0.5)",e.lineWidth=t,e.strokeRect(0,0,n,o)}drawBasePoint(e,{basePoint:t,px:n,top:o,left:i,windowWidth:s,windowHeight:r,bottom:a,right:l,screenCoordsToSceneCoords:c}){const h=c(i,o),d=c(s-l,r-a);e.beginPath(),e.moveTo(h.x,t.y),e.lineTo(d.x,t.y),e.moveTo(t.x,h.y),e.lineTo(t.x,d.y),e.lineWidth=n,e.strokeStyle=Fe.a.A400,e.stroke()}render(){return i.a.createElement(Ye,{draw:this.draw})}},Xe=n(562),qe=n.n(Xe),Je=n(140),Qe=n.n(Je),Ze=n(9),et=n(219),tt=n.n(et);class nt{constructor(){this.id=Object(Ze.b)(),this.keyPointsById={}}get keyPoints(){return Object.keys(this.keyPointsById).map(e=>this.keyPointsById[e])}addKeyPoint(e){this.keyPointsById[String(e.id)]=e}get(e){return this.keyPointsById[String(e)]||null}has(e){return this.get(e.id)===e}getNearestTo(e){return tt()(this.keyPoints,t=>t.distanceTo(e))}}Object(Ze.f)(nt,"KeyPointSet",[],{keyPointsById:Object(Ze.e)(y.a)});var ot=Object(v.i)(nt,{keyPointsById:v.n,keyPoints:v.f,addKeyPoint:v.d}),it=n(138);class st{constructor(){this.id=Object(Ze.b)(),this.keyPointSet=void 0,this.pointsByKeyPointId={}}init(e){return this.keyPointSet=e,this}get definedKeyPoints(){return Object.keys(this.pointsByKeyPointId).filter(e=>null!=this.pointsByKeyPointId[e]).map(e=>{const t=this.keyPointSet.get(e);return l()(t,"point must exist"),t})}get thinPlateSplinesX(){const e=this.keyPointSet.keyPoints,t=e.map(e=>this.getAtKeyPoint(e).x);return new it.a(e,t)}get thinPlateSplinesY(){const e=this.keyPointSet.keyPoints,t=e.map(e=>this.getAtKeyPoint(e).y);return new it.a(e,t)}getAtKeyPoint(e){if(l()(this.keyPointSet.has(e),"key point must be in scene"),null!=this.pointsByKeyPointId[String(e.id)])return this.pointsByKeyPointId[String(e.id)];const t=e.findNearest(this.definedKeyPoints);return l()(t,"nearest point must be found"),this.pointsByKeyPointId[String(t.id)]}setAtKeyPoint(e,t){l()(this.keyPointSet.has(e),"keyPoint must exist in scene"),this.pointsByKeyPointId[String(e.id)]=t}getAtBasePoint(e){return new y.a(this.thinPlateSplinesX.getValue(e),this.thinPlateSplinesY.getValue(e))}transform(e){const t=(new st).init(this.keyPointSet);return this.definedKeyPoints.forEach(n=>{t.setAtKeyPoint(n,e(this.getAtKeyPoint(n),n))}),t}add(e){return this.transform((t,n)=>t.add(e.getAtKeyPoint(n)))}subtract(e){return this.transform((t,n)=>t.subtract(e.getAtKeyPoint(n)))}scale(e){return this.transform(t=>t.scale(e))}}Object(Ze.f)(st,"MagicPointThingy",[],{keyPointSet:Object(Ze.c)(ot),pointsByKeyPointId:Object(Ze.e)(y.a)});var rt=Object(v.i)(st,{keyPointSet:v.n,pointsByKeyPointId:v.n,setAtKeyPoint:v.d,definedKeyPoints:v.f,thinPlateSplinesX:v.f,thinPlateSplinesY:v.f});class at{constructor(){this.id=Object(Ze.b)(),this.originPoint=void 0,this._leadingControlPointRelative=null,this._followingControlPointRelative=null,this.areControlPointsMirrored=!0}init(e){return this.originPoint=e,this}get leadingControlPointRelative(){return this._leadingControlPointRelative}set leadingControlPointRelative(e){this._leadingControlPointRelative=e}get followingControlPointRelative(){if(this.areControlPointsMirrored){const e=this.leadingControlPointRelative;return e?e.scale(-1):null}return this._followingControlPointRelative}set followingControlPointRelative(e){this.areControlPointsMirrored?this.leadingControlPointRelative=e?e.scale(-1):null:this._followingControlPointRelative=e}get leadingControlPointGlobal(){const e=this.leadingControlPointRelative;return e?this.originPoint.add(e):null}set leadingControlPointGlobal(e){this.leadingControlPointRelative=e?e.subtract(this.originPoint):null}get followingControlPointGlobal(){const e=this.followingControlPointRelative;return e?this.originPoint.add(e):null}set followingControlPointGlobal(e){this.followingControlPointRelative=e?e.subtract(this.originPoint):null}}Object(Ze.f)(at,"ShapePoint",["areControlPointsMirrored"],{originPoint:Object(Ze.c)(rt),_leadingControlPointRelative:Object(Ze.c)(rt),_followingControlPointRelative:Object(Ze.c)(rt)});var lt=Object(v.i)(at,{origin:v.n,_leadingControlPointRelative:v.n,_followingControlPointRelative:v.n,areControlPointsMirrored:v.n,leadingControlPointGlobal:v.f,leadingControlPointRelative:v.f,followingControlPointGlobal:v.f,followingControlPointRelative:v.f});function ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){ht(e,t,n[t])})}return e}function ht(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const dt=(e,t,n,o={})=>{const i=ct({fill:!1},o).fill;e.beginPath(),((e,{x:t,y:n},o)=>{const i=o/2;e.moveTo(t-i,n-i),e.lineTo(t+i,n-i),e.lineTo(t+i,n+i),e.lineTo(t-i,n+i),e.lineTo(t-i,n-i)})(e,t,n),i?e.fill():(e.globalCompositeOperation="destination-out",e.fill(),e.globalCompositeOperation="source-over",e.stroke())},pt=(e,t,n,o,i={})=>{const s=ct({fill:!1},i).fill;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke(),e.beginPath(),((e,{x:t,y:n},o)=>{const i=o/2;e.ellipse(t,n,i,i,0,0,2*Math.PI)})(e,n,o),s?e.fill():(e.globalCompositeOperation="destination-out",e.fill(),e.globalCompositeOperation="source-over",e.stroke())},ut=(e,t,n,o,i={})=>{const s=ct({fillOrigin:!1,fillLeadingControl:!1,fillFollowingControl:!1},i),r=s.fillOrigin,a=s.fillLeadingControl,l=s.fillFollowingControl,c=t.originPoint.getAtBasePoint(n);t.leadingControlPointGlobal&&pt(e,c,t.leadingControlPointGlobal.getAtBasePoint(n),o,{fill:a}),t.followingControlPointGlobal&&pt(e,c,t.followingControlPointGlobal.getAtBasePoint(n),o,{fill:l}),dt(e,c,o,{fill:r})},gt=(e,{x:t,y:n},o,i)=>{e.beginPath(),e.arc(t,n,10*i,0,2*Math.PI,!0),e.moveTo(t-15*i,n),e.lineTo(t-5*i,n),e.moveTo(t+5*i,n),e.lineTo(t+15*i,n),e.moveTo(t,n-15*i),e.lineTo(t,n-5*i),e.moveTo(t,n+5*i),e.lineTo(t,n+15*i),o&&(e.moveTo(t-14.5*i,n-2.5*i),e.lineTo(t-14.5*i,n+2.5*i),e.moveTo(t+14.5*i,n-2.5*i),e.lineTo(t+14.5*i,n+2.5*i),e.moveTo(t-2.5*i,n-14.5*i),e.lineTo(t+2.5*i,n-14.5*i),e.moveTo(t-2.5*i,n+14.5*i),e.lineTo(t+2.5*i,n+14.5*i))},mt=(e,t,n)=>{const o=new Path2D,i=(e,n)=>{const i=n.originPoint.getAtBasePoint(t),s=i.x,r=i.y,a=e.leadingControlPointGlobal,l=n.followingControlPointGlobal;if(a&&l){const e=a.getAtBasePoint(t),n=e.x,i=e.y,c=l.getAtBasePoint(t),h=c.x,d=c.y;o.bezierCurveTo(n,i,h,d,s,r)}else if(a){const e=a.getAtBasePoint(t),n=e.x,i=e.y;o.quadraticCurveTo(n,i,s,r)}else if(l){const e=l.getAtBasePoint(t),n=e.x,i=e.y;o.quadraticCurveTo(n,i,s,r)}else o.lineTo(s,r)};return e.forEach((n,s)=>{if(0===s){const e=n.originPoint.getAtBasePoint(t),i=e.x,s=e.y;o.moveTo(i,s)}else i(e[s-1],n)}),n&&(i(e[e.length-1],e[0]),o.closePath()),o},wt=5,Pt=150;var vt=G(I(class extends o.Component{constructor(...e){var t;return t=super(...e),this._unsubscribes=[],this._drag=null,this.handlePointerDown=(()=>{const e=this.props.viewport.pointer.scenePosition;l()(e,"viewport must have position to be pressed"),this._drag={startTime:Date.now(),startScenePosition:e.clone(),hasNotifiedStart:!1,asyncDrag:this.startAsyncDrag()},this.props.onPointerDown&&this.props.onPointerDown(this.props.viewport)}),this.handlePointerMove=(()=>{const e=this.props.viewport,t=e.pointer.screenPosition;l()(t,"viewport must have position for pointermove");const n=this._drag;if(n){if(!n.hasNotifiedStart){const o=e.sceneCoordsToScreenCoords(n.startScenePosition.x,n.startScenePosition.y);(n.startTime+Pt>Date.now()||t.distanceTo(o)>wt)&&(this.props.onDragStart&&this.props.onDragStart(e),n.hasNotifiedStart=!0,n.asyncDrag&&n.asyncDrag.notifyStart())}n.hasNotifiedStart&&(this.props.onDragMove&&this.props.onDragMove(this.props.viewport),n.asyncDrag&&n.asyncDrag.notifyMove())}this.props.onPointerMove&&this.props.onPointerMove(this.props.viewport)}),this.handlePointerUp=(()=>{const e=this._drag;l()(e,"drag must be defined"),e.hasNotifiedStart?this.props.onDragEnd&&this.props.onDragEnd(this.props.viewport):this.props.onClick&&this.props.onClick(this.props.viewport),this.props.onPointerUp&&this.props.onPointerUp(this.props.viewport),e.asyncDrag&&e.asyncDrag.notifyEnd()}),t}componentDidMount(){const e=this.props.viewport.pointer;this._unsubscribes.push(e.onPointerDown(this.handlePointerDown)),this._unsubscribes.push(e.onPointerMove(this.handlePointerMove)),this._unsubscribes.push(e.onPointerUp(this.handlePointerUp))}componentDidUpdate(e){const t=this.props.cursor;e.cursor!==t&&t!==this.props.viewport.pointer.cursor&&(this.props.viewport.pointer.cursor=null==t?"default":t)}componentWillUnmount(){this._unsubscribes.forEach(e=>e()),this._unsubscribes=[]}startAsyncDrag(){const e=this.props,t=e.viewport,n=e.onDragAsync;if(!n)return null;let o=e=>{},i=e=>{};return n(t,new Promise(e=>{o=e}),()=>new Promise(e=>{i=e})),{notifyStart:()=>{o(!1)},notifyMove:()=>{i(!0)},notifyEnd:()=>{o(!0),i(!1)}}}render(){return null}})),yt=n(563),ft=n.n(yt),bt=n(564),Ct=n.n(bt);var St=G(I(Object(_.withStyles)({canvas:{position:"absolute",top:0,left:0}})(Object(d.a)(class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.draw=(e=>{const t=this.props,n=t.viewport,o=t.width,i=t.height,s=t.draw;e.translate(o/2,i/2),s(e,n)}),t}render(){const e=this.props,t=e.width,n=e.height,o=e.sceneX,s=e.sceneY,r=e.viewport,a=e.classes,l=r.panX,c=r.panY,h=r.zoom,d=o*h+l-t/2+r.left,p=s*h+c-n/2+r.top;return i.a.createElement(He,{draw:this.draw,className:a.canvas,width:t,height:n,style:{transform:`translate(${d}px, ${p}px)`}})}}))));var Et=G(I(Object(d.a)(class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.draw=((e,{nearestKeyPoint:t,keyboard:n})=>{const o=t===this.props.keyPoint;gt(e,{x:0,y:0},o,1),e.lineWidth=1,e.strokeStyle=o?Ct.a.A700:ft.a.A400,e.stroke()}),t}render(){const e=this.props.keyPoint;return i.a.createElement(St,{draw:this.draw,width:30,height:30,sceneX:e.x,sceneY:e.y})}})));var kt=G(I(Object(d.a)(class extends i.a.Component{render(){const e=this.props,t=e.viewport,n=e.showAll,o=t.scene.keyPointSet,s=t.nearestKeyPoint,r=n||t.keyboard.isPressed("ctrl");return i.a.createElement(i.a.Fragment,null,o.keyPoints.filter(e=>!!r||e===s).map(e=>i.a.createElement(Et,{keyPoint:e,key:String(e.id)})))}})));var Ot=class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.drawHover=((e,t)=>{const n=this.getHoveredItem(t);n&&this.drawSelectionItem(e,n,qe.a.A400,t)}),this.drawSelection=((e,t)=>{t.editor.selection.forEach(n=>{this.drawSelectionItem(e,n,Qe.a.A400,t)})}),this.handleClick=(e=>{const t=e.keyboard,n=e.editor,o=this.getHoveredItem(e);o?t.isPressed("shift")||t.isPressed("ctrl")?n.toggleSelected(o):n.replaceSelection([o]):n.clearSelection()}),this.handleDragAsync=(async(e,t,n)=>{const o=this.getHoveredItem(e);if(o)switch(o.type){case"MagicPointThingySelectionItem":return await this.handleMagicPointThingyDrag(o,e,t,n);case"ShapeSelectionItem":return await this.handleShapeDrag(o,e,t,n);case"ControlPointSelectionItem":return await this.handleControlPointDrag(o,e,t,n);default:throw new Error(`Unknown selection type: ${o.type}`)}}),t}getHoveredItem({pointer:e,editor:t,nearestKeyPoint:n,px:o}){const i=e.scenePosition;if(!i)return null;const s=8*o;for(const r of t.selection)if("MagicPointThingySelectionItem"===r.type){const e=r.point.leadingControlPointGlobal;if(e&&e.getAtKeyPoint(n).distanceTo(i)<s)return{type:"ControlPointSelectionItem",point:r.point,inShape:r.inShape,controlPoint:"leading"};const t=r.point.followingControlPointGlobal;if(t&&t.getAtKeyPoint(n).distanceTo(i)<s)return{type:"ControlPointSelectionItem",point:r.point,inShape:r.inShape,controlPoint:"following"}}return e.hoveredItem}drawSelectionItem(e,t,n,o){switch(t.type){case"ShapeSelectionItem":return this.drawShapeSelectionGuide(e,t.shape,n,o);case"MagicPointThingySelectionItem":return this.drawPointSelectionGuide(e,t.inShape,t.point,n,o,{fillOrigin:!0,fillLeadingControl:!1,fillFollowingControl:!1});case"ControlPointSelectionItem":return this.drawPointSelectionGuide(e,t.inShape,t.point,n,o,{fillOrigin:!1,fillLeadingControl:"leading"===t.controlPoint,fillFollowingControl:"following"===t.controlPoint});default:throw new Error(`Unknown selection item type: ${t.type}`)}}drawShapeSelectionGuide(e,t,n,o){this.drawShapeOutline(e,t,n,o),this.drawPointOutlines(e,t,n,o)}drawPointSelectionGuide(e,t,n,o,i,s){this.drawShapeSelectionGuide(e,t,o,i),e.beginPath(),e.strokeStyle=o,e.fillStyle=o;const r=i.px,a=i.basePoint;ut(e,n,a,5*r,s)}drawShapeOutline(e,t,n,{px:o,basePoint:i}){e.lineWidth=o,e.strokeStyle=n,e.stroke(t.getCanvasPathAtBasePoint(i))}drawPointOutlines(e,t,n,{px:o,basePoint:i}){e.lineWidth=o,e.strokeStyle=n,t.points.forEach(t=>{dt(e,t.originPoint.getAtBasePoint(i),5*o)})}async handleMagicPointThingyDrag(e,t,n,o){if(!await n)for(;await o();){const n=t.pointer.scenePosition;n&&e.point.originPoint.setAtKeyPoint(t.nearestKeyPoint,n)}}async handleShapeDrag(e,t,n,o){let i=t.pointer.scenePosition;if(l()(i,"viewport pointer must be active"),!await n)for(;await o();){const n=t.pointer.scenePosition;l()(n,"viewport pointer must be active");const o=n.subtract(i);e.shape.points.forEach(e=>{e.originPoint.setAtKeyPoint(t.nearestKeyPoint,e.originPoint.getAtKeyPoint(t.nearestKeyPoint).add(o))}),i=n}}async handleControlPointDrag(e,t,n,o){if(!await n)for(;await o();){const n=t.pointer.scenePosition;if(n)if("leading"===e.controlPoint){const o=e.point.leadingControlPointGlobal;l()(o,"leading control point must exist"),o.setAtKeyPoint(t.nearestKeyPoint,n),e.point.leadingControlPointGlobal=o}else{const o=e.point.followingControlPointGlobal;l()(o,"following control point must exist"),o.setAtKeyPoint(t.nearestKeyPoint,n),e.point.followingControlPointGlobal=o}}}render(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(kt,null),i.a.createElement(Ye,{draw:this.drawHover}),i.a.createElement(Ye,{draw:this.drawSelection}),i.a.createElement(vt,{onClick:this.handleClick,onDragAsync:this.handleDragAsync}))}};const xt="#000000",Tt="#abcdef";class Dt{constructor(){this.id=Object(Ze.b)(),this.hasStroke=!0,this.hasFill=!1,this.strokeWidth=1,this.strokeColor=xt,this.fillColor=Tt}drawCurrentContextPath(e){this.hasFill&&(e.fillStyle=this.fillColor,e.fill()),this.hasStroke&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.strokeColor,e.stroke())}drawPath(e,t){this.hasFill&&(e.fillStyle=this.fillColor,e.fill(t)),this.hasStroke&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.strokeColor,e.stroke(t))}}Object(Ze.f)(Dt,"ShapeStyle",["hasFill","hasStroke","strokeWidth","strokeColor","fillColor"]);var jt=Object(v.i)(Dt,{strokeWidth:v.n,strokeColor:v.n,fillColor:v.n,hasStroke:v.n,hasFill:v.n});class Kt{constructor(){this.id=Object(Ze.b)(),this.style=new jt,this.points=[],this.isClosed=!1}addPoint(e){this.points.push(e)}close(){this.isClosed=!0}getCanvasPathAtBasePoint(e){return mt(this.points,e,this.isClosed)}drawToCanvasAtBasePoint(e,t){this.style.drawPath(e,this.getCanvasPathAtBasePoint(t))}}Object(Ze.f)(Kt,"Shape",["isClosed"],{style:Object(Ze.c)(jt),points:Object(Ze.d)(rt)});var Mt=Object(v.i)(Kt,{style:v.n,points:v.n,isClosed:v.n});var At=I(Object(d.a)(Object(v.i)(class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.targetShape=null,this.isDragging=!1,this.draw=((e,{basePoint:t,px:n})=>{const o=this.getTargetScenePoints(),i=o.shapePoints,s=o.isClosed;e.lineWidth=n,e.strokeStyle=Qe.a.A400,e.stroke(mt(i,t,s)),i.forEach(o=>{ut(e,o,t,5*n)})}),this.handleDrag=(async({pointer:e,editor:t,nearestKeyPoint:n},o,i)=>{const s=e.scenePosition;l()(s,"pointer must be active");const r=this.getOrCreateTargetShape(),a=this.shouldSnapClosed();let c;if(a)c=r.points[0],r.close();else{const e=t.scene.createMagicPointThingy();e.setAtKeyPoint(n,s),c=(new lt).init(e),r.addPoint(c)}if(!await o){for(this.isDragging=!0;await i();){const o=c.leadingControlPointGlobal||t.scene.createMagicPointThingy();l()(e.scenePosition,"scenePosition must be set"),o.setAtKeyPoint(n,e.scenePosition),c.leadingControlPointGlobal=o}this.isDragging=!1}a&&(this.targetShape=null)}),t}shouldSnapClosed(){const e=this.props.viewport,t=e.nearestKeyPoint,n=e.pointer,o=e.sceneCoordsToScreenCoords,i=n.screenPosition;if(!i)return!1;const s=this.targetShape&&this.targetShape.points;if(!s||s.length<2)return!1;const r=s[0].originPoint.getAtKeyPoint(t);return o(r.x,r.y).distanceTo(i)<7}getTargetScenePoints(){const e=this.props.viewport,t=e.pointer,n=e.editor,o=e.nearestKeyPoint,i=this.targetShape,s=this.isDragging,r=t.scenePosition,a=i?i.points:[];if(r){if(s)return{shapePoints:a,isClosed:!!i&&i.isClosed,isLastPointGuide:!1};if(this.shouldSnapClosed())return{shapePoints:a,isClosed:!0,isLastPointGuide:!1};const e=n.scene.createMagicPointThingy();return e.setAtKeyPoint(o,r),{shapePoints:[...a,(new lt).init(e)],isClosed:!1,isLastPointGuide:!0}}return{shapePoints:a,isClosed:!1,isLastPointGuide:!1}}getOrCreateTargetShape(){if(this.targetShape)return this.targetShape;const e=new Mt;return this.props.viewport.editor.scene.addShape(e),this.targetShape=e,e}render(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(kt,null),i.a.createElement(Ye,{draw:this.draw}),i.a.createElement(vt,{onDragAsync:this.handleDrag}))}},{targetShape:v.n,isDragging:v.n})));var It=I(Object(d.a)(Object(v.i)(class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.cursor="default",this.draw=((e,{editor:t,pointer:n,px:o,sceneCoordsToScreenCoords:i})=>{if(this.cursor="default",this.getHoveredKeyPoint())this.cursor="move";else{const t=n.scenePosition;if(null===t)return;gt(e,t,!1,o),e.lineWidth=o,e.strokeStyle=Qe.a.A400,e.stroke(),this.cursor="none"}}),this.handleDrag=(async({pointer:e,editor:t,basePoint:n},o,i)=>{const s=this.getHoveredKeyPoint();if(s){if(await o)return;for(;await i();){const t=e.scenePosition;t&&(s.set(t),n.set(t))}}else{const i=e.scenePosition;await o&&i&&(t.scene.keyPointSet.addKeyPoint(i),n.set(i))}}),t}getHoveredKeyPoint(){const e=this.props.viewport,t=e.pointer,n=e.editor,o=e.px,i=t.scenePosition;if(null===i)return;const s=n.scene.keyPointSet.getNearestTo(i);return s.distanceTo(i)<10*o?s:null}render(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(kt,{showAll:!0}),i.a.createElement(Ye,{draw:this.draw}),i.a.createElement(vt,{onDragAsync:this.handleDrag,cursor:this.cursor}))}},{cursor:v.n})));var _t=G(I(Object(d.a)(class extends i.a.Component{render(){const e=this.props.viewport.editor.tool;switch(e){case"SELECT":return i.a.createElement(Ot,null);case"PEN":return i.a.createElement(At,null);case"KEY_POINT":return i.a.createElement(It,null);default:throw new Error(`unknown tool: ${e}`)}}})));var Bt=Object(d.a)(class extends i.a.Component{constructor(...e){var t;return t=super(...e),this.draw=((e,{basePoint:t})=>{this.props.shape.drawToCanvasAtBasePoint(e,t)}),t}render(){return i.a.createElement(Ye,{draw:this.draw})}});var Rt=G(I(Object(d.a)(class extends i.a.Component{render(){const e=this.props.viewport.editor.scene;return i.a.createElement(i.a.Fragment,null,e.shapes.map((e,t)=>i.a.createElement(Bt,{shape:e,key:t})))}})));var Ut=G(I(class extends i.a.Component{constructor(...e){var t;return t=super(...e),this._unsubscribes=[],this.handlePointerMove=(({keyboard:e,pointer:t,basePoint:n})=>{e.isPressed("ctrl")&&t.scenePosition&&n.set(t.scenePosition)}),this.handleCtrlDown=(()=>{const e=this.props.viewport,t=e.pointer,n=e.basePoint;t.scenePosition&&n.set(t.scenePosition)}),this.handleCtrlUp=(()=>{const e=this.props.viewport,t=e.basePoint,n=e.nearestKeyPoint;t.set(n)}),t}render(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(vt,{onPointerMove:this.handlePointerMove}),i.a.createElement(Ne,{name:"ctrl",onDown:this.handleCtrlDown,onUp:this.handleCtrlUp}))}}));var zt=Object(d.a)(class extends i.a.Component{render(){const e=this.props.editor;return i.a.createElement(i.a.Fragment,null,i.a.createElement(L,null),i.a.createElement(Le,{editor:e}),i.a.createElement(Te,{editor:e}),i.a.createElement(A,{editor:e,style:{position:"absolute",top:64,left:48,right:300,bottom:0}},i.a.createElement(Rt,null),i.a.createElement(Ve,null),i.a.createElement(Ut,null),i.a.createElement(_t,null)))}});class Nt{constructor(){this.id=Object(Ze.b)(),this.width=void 0,this.height=void 0,this.keyPointSet=void 0,this.shapes=[]}static deserialize(e){const t=Object(Ze.a)(e);return l()(t instanceof Nt,"deserialized object is not Scene"),t}init(e,t){return this.width=e,this.height=t,this.keyPointSet=new ot,this.keyPointSet.addKeyPoint(new y.a(.25*e,.25*t)),this.keyPointSet.addKeyPoint(new y.a(.75*e,.25*t)),this.keyPointSet.addKeyPoint(new y.a(.75*e,.75*t)),this.keyPointSet.addKeyPoint(new y.a(.25*e,.75*t)),this}addShape(e){this.shapes.push(e)}serialize(){return Object(Ze.g)(this)}createMagicPointThingy(){return(new rt).init(this.keyPointSet)}}Object(Ze.f)(Nt,"Scene",["width","height"],{keyPointSet:Object(Ze.c)(ot),shapes:Object(Ze.d)(Mt)});var Wt=Object(v.i)(Nt,{width:v.n,height:v.n,shapes:v.n});window.Scene=Nt;var Lt=n(218),$t=n.n(Lt);const Ft="drag-animate.autosave";class Gt{static fromAutoSave(e){try{const t=localStorage.getItem(Ft);l()(null!=t,"no autosave present");const n=JSON.parse(t),o=Wt.deserialize(n);return new Gt(o)}catch(t){return console.warn(`Could not resore from autosave: ${t.message}`),new Gt(e())}}constructor(e){this.tool=_e.SELECT,this.scene=void 0,this.selection=[],this.commands={replaceDocumentWithNew:(e=200,t=100)=>{this.scene=(new Wt).init(e,t)}},this.scene=e,Object.keys(this.commands).forEach(e=>{this.commands[e]=Object(v.d)(`Editor.commands.${e}`,this.commands[e])})}startAutosaving(){return Object(v.e)(()=>{try{const e=this.scene.serialize(),t=JSON.stringify(e);localStorage.setItem(Ft,t),console.log("Saved.")}catch(e){console.warn(`couldnt autosave: ${e.message}`)}},{delay:2500})}setTool(e){this.tool=e}replaceSelection(e){this.selection=e}toggleSelected(e){const t=this.selection.findIndex(t=>$t()(t,e));null!=t?this.selection.splice(t,1):this.selection.push(e)}clearSelection(){this.replaceSelection([])}}var Ht=Object(v.i)(Gt,{scene:v.n,tool:v.n,selection:v.n,setTool:v.d,replaceSelection:v.d,clearSelection:v.d,toggleSelected:v.d});E.setup();const Yt=document.getElementById("root");l()(Yt,"root must exist");const Vt=Ht.fromAutoSave(()=>(new Wt).init(200,100));Vt.startAutosaving(),window.editor=Vt,r.a.render(i.a.createElement(i.a.Fragment,null,i.a.createElement(h.a,null),i.a.createElement(zt,{editor:Vt})),Yt)},560:function(e,t,n){n(559),e.exports=n(228)},9:function(e,t,n){"use strict";var o=n(5),i=n.n(o);let s=0;const r=()=>`${Date.now().toString(36)}.${(s++).toString(36)}`;function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){l(e,t,n[t])})}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"c",function(){return v}),n.d(t,"d",function(){return y}),n.d(t,"e",function(){return f}),n.d(t,"f",function(){return C}),n.d(t,"g",function(){return S}),n.d(t,"a",function(){return k}),n.d(t,"b",function(){return r});const c=e=>new Error(`impossible value ${e}`),h=new Map,d=new Map,p=(e,t)=>({ctor:t.ctor||e.ctor,name:t.name||e.name,primitives:[...e.primitives,...t.primitives],refs:a({},e.refs,t.refs)}),u=e=>{const t=h.get(e);return i()(t,`model ${e.__proto__.constructor.name} is not serializable`),t},g=(e,t)=>{const n=(e=e,i()(!String(e.id).includes("#"),`id "${String(e.id)}" must not include "#"`),`${u(e.__proto__.constructor).name}#${String(e.id)}`);return t[n]||(t[n]=P(e,t)),n};var m;const w=(e,t,n)=>{if(null===t)return null;switch(e.type){case"one":return g(t,n);case"list":return((e,t)=>e.map(e=>g(e,t)))(t,n);case"object-map":return((e,t)=>Object.keys(e).map(n=>[n,g(e[n],t)]).reduce((e,[t,n])=>a({},e,{[t]:n}),{}))(t,n);default:throw c(e.type)}},P=(e,t)=>{const n=u(e.__proto__.constructor),o=n.primitives,i=n.refs,s={};return o.forEach(t=>s[t]=e[t]),Object.keys(i).forEach(n=>{s[n]=w(i[n],e[n],t)}),s},v=e=>({type:"one",target:e}),y=e=>({type:"list",target:e}),f=e=>({type:"object-map",target:e}),b=e=>{const t=e.__proto__,n=t?b(t):[],o=h.get(e);return o?[...n,o]:n},C=(e,t,n,o={})=>{i()(!t.includes("#"),`name "${t}" cant include "#"`),i()(!d.has(t),`serializable class with name ${t} already exists`);const s=[...b(e),{ctor:e,name:t,primitives:n,refs:o}].reduce(p);h.set(e,s),d.set(t,s)},S=e=>{const t={};return{rootId:g(e,t),objectsById:t}},E=(e,t,n={})=>{if(!n[t]){const o=e[t];i()(o,`no object found for id ${String(t)}`);const s=(e=>{const t=e.split("#");i()(2===t.length,`invalid id "${e}"`);const n=d.get(t[0]);return i()(n,`unknown serialize model ${t[0]}`),{model:n,id:t[1]}})(t),r=s.model,l=s.id,h=r.primitives,p=r.refs,u=new(0,r.ctor);u.id=l,h.forEach(e=>u[e]=o[e]),Object.keys(p).forEach(t=>{u[t]=((e,t,n,o={})=>{if(null===t)return null;switch(e.type){case"one":return E(n,t,o);case"list":return t.map(e=>E(n,e,o));case"object-map":return Object.keys(t).map(e=>[e,E(n,t[e],o)]).reduce((e,[t,n])=>a({},e,{[t]:n}),{});default:throw c(e.type)}})(p[t],o[t],e,n)}),n[t]=u}return n[t]},k=e=>{const t=e.rootId,n=e.objectsById;return E(n,t)}}},[[560,0,1]]]);
//# sourceMappingURL=main.ff82fe4a.chunk.js.map